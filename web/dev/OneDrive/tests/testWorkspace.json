{"fileType":"apogee app js workspace","version":"0.60","references":{"viewState":{"treeState":1,"lists":{"es module":{"treeState":0},"js link":{"treeState":0},"css link":{"treeState":0}}}},"code":{"model":{"fileType":"apogee model","version":0.3,"name":"Workspace","children":{"main":{"name":"main","type":"apogee.Folder","children":{"openFile":{"name":"openFile","type":"apogee.FunctionMember","updateData":{"argList":["admin"],"functionBody":"let onOpen = formValue => {\n    let onFileJsonData = data => {\n        admin.getCommandMessenger().dataCommand(\"inContent\",data);\n    }\n    launchOneDrivePicker(onFileJsonData);\n}\n\nreturn [ \n    {\n        type: \"submit\",\n        onSubmit: onOpen,\n        submitLabel: \"Open\"\n    }\n]","supplementalCode":"function launchOneDrivePicker(onFileJsonData){\r\n    var odOptions = {\r\n        clientId: \"d87a2f91-7064-41d0-85b2-3e0775068ac2\",\r\n        action: \"download\",\r\n        multiSelect: false,\r\n        advanced: {\r\n        },\r\n        success: response => onOpenSuccess(response,onFileJsonData),\r\n        cancel: onOpenCancel,\r\n        error: onOpenError\r\n    }\r\n  OneDrive.open(odOptions);\r\n}\r\n\r\nfunction onOpenSuccess(responseObject,onFileJsonData) {\r\n    let itemList = responseObject.value;\r\n    if((itemList)&&(itemList.length > 0)) {\r\n        let item = itemList[0];\r\n        //this gives me the metadata???\r\n        let downloadUrl = item[\"@microsoft.graph.downloadUrl\"];\r\n        fetch(downloadUrl).then(response => response.json()).then(data => {\r\n            onFileJsonData(data);\r\n        })\r\n\r\n        // //let url = item.endpoint + \"/drives/\" + item.parentReference.driveId + \"/items/\" + item.id;\r\n        // let url = responseObject.apiEndpoint + \"drives/\" + item.parentReference.driveId + \"/items/\" + item.id;\r\n        // let editor = document.getElementById(\"fileContent\");\r\n        // fetch(url,{\r\n        //     headers: {\r\n        //         Authorization: \"bearer \" + responseObject.accessToken\r\n        //     }\r\n        // })\r\n        // .then(response => response.json())\r\n        // .then(data => {\r\n        //     editor.value = JSON.stringify(data);\r\n\r\n            \r\n        .catch(error => alert(\"error retrieving file: \" + error.toString()));\r\n    }\r\n}\r\n\r\nfunction onOpenCancel() {\r\n    alert(\"File open canceled!\");\r\n}"}},"openFileCustom":{"name":"openFileCustom","type":"apogee.JsonMember","updateData":{"data":""}},"saveFile":{"name":"saveFile","type":"apogee.FunctionMember","updateData":{"argList":["admin"],"functionBody":"let onSave = formValue => {\n    if(formValue.fileName) {\n        launchSaveToOneDrive(formValue.fileName,outContent);\n    }\n    else {\n        alert(\"Invalid file name!\");\n    }\n}\n\nreturn [ \n    {\n        type: \"textField\",\n        label: \"File Name: \",\n        key: \"fileName\"\n    },\n    {\n        type: \"submit\",\n        onSubmit: onSave,\n        submitLabel: \"Save\"\n    }\n]","supplementalCode":"function launchSaveToOneDrive(fileName,fileJsonContent) {\r\n\r\n    let fileStringContent = JSON.stringify(fileJsonContent);\r\n\r\n    let dataUrl = \"data:application/json;base64,\" + btoa(fileStringContent);\r\n\r\n    let odOptions = {\r\n        clientId: \"d87a2f91-7064-41d0-85b2-3e0775068ac2\",\r\n        action: \"save\",\r\n        sourceUri: dataUrl,\r\n        fileName: fileName,\r\n        viewType: \"all\",\r\n        openInNewWindow: true,\r\n        advanced: {},\r\n        success: onSaveSuccess,\r\n        progress: onSaveProgress,\r\n        cancel: onSaveCancel,\r\n        error: onSaveError\r\n    };\r\n    OneDrive.save(odOptions);\r\n}\r\n\r\nfunction onSaveSuccess(response) {\r\n    alert(\"File saved!\");\r\n    console.log(JSON.stringify(response));\r\n}\r\n\r\nfunction onSaveProgress(percent) {\r\n    console.log(\"Save percent complete: \" + percent + \"%\");\r\n}\r\n\r\nfunction onSaveCancel() {\r\n    alert(\"File save canceled!\");\r\n}\r\n\r\nfunction onSaveError(error) {\r\n    alert(\"Error saving file: \" + error.toString());\r\n}"}},"inContent":{"name":"inContent","type":"apogee.JsonMember","updateData":{"data":[2,4,6]}},"outContent":{"name":"outContent","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"return inContent.map(x => 2*x)","supplementalCode":""}}}}}},"components":{"main":{"type":"apogeeapp.PageComponent","data":{"doc":{"type":"doc","content":[{"type":"apogeeComponent","attrs":{"name":"openFile","id":0,"state":""}},{"type":"apogeeComponent","attrs":{"name":"saveFile","id":0,"state":""}},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"inContent","id":0,"state":""}},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"outContent","id":0,"state":""}},{"type":"paragraph"},{"type":"heading1","content":[{"type":"text","text":"OTHER"}]},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"openFileCustom","id":0,"state":""}},{"type":"paragraph"},{"type":"paragraph"},{"type":"paragraph"}]}},"children":{"openFile":{"type":"apogeeapp.ActionFormCell","viewState":{"childDisplayState":{"views":{"Form":{"isViewActive":true},"Code":{"isViewActive":true,"height":7000},"Private":{"isViewActive":true,"height":7000}}}}},"openFileCustom":{"type":"apogeeapp.CustomCell","resource":{"html":"<button onclick=\"launchOneDrivePicker()\">Open</button>","css":"","uiCode":""},"destroyOnInactive":false,"viewState":{"childDisplayState":{"views":{"Display":{"isViewActive":true},"Input Code":{"isViewActive":false},"Input Private":{"isViewActive":false},"HTML":{"height":7000,"isViewActive":true},"CSS":{"isViewActive":false},"uiGenerator()":{"isViewActive":false}}}}},"saveFile":{"type":"apogeeapp.ActionFormCell","viewState":{"childDisplayState":{"views":{"Form":{"isViewActive":true},"Code":{"isViewActive":true,"height":7000},"Private":{"isViewActive":true,"height":7000}}}}},"inContent":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false},"Private":{"isViewActive":false}}}}},"outContent":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":true,"height":7000},"Private":{"isViewActive":false}}}}}},"viewState":{"childDisplayState":null,"treeState":1,"tabOpened":true,"tabShowing":true}},"viewState":{"treeState":1}}},"viewState":{"treeState":1}}