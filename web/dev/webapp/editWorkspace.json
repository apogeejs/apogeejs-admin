{"fileType":"apogee workspace","jsLinks":[],"cssLinks":[],"workspace":{"fileType":"apogee workspace","version":0.2,"data":{"name":"editMetaFileTest","type":"apogee.Folder","children":{"micemetarecipeDataAccess":{"name":"micemetarecipeDataAccess","type":"apogee.Folder","children":{"createRecord":{"name":"createRecord","type":"apogee.FunctionTable","updateData":{"argList":["recordInfo","fieldMap"],"functionBody":"var record = {};\n\nrecord.Id = getId();\nrecord.Type = recordInfo.name;\nrecord.Fields = fieldMap;\nrecord.read_perm = READ_PERM;\nrecord.edit_perm = EDIT_PERM;\n\nreturn record;","supplementalCode":"var READ_PERM = 2;\nvar EDIT_PERM = 15;\n\nvar nextId = -1;\n\nfunction getId() {\n    return nextId--;\n}","description":"This method creates a record given the field values and record info \nfrom the data set info. It creates and ID and uses standard permissions."}},"recordsToCreateInstructions":{"name":"recordsToCreateInstructions","type":"apogee.FunctionTable","updateData":{"argList":["recordList"],"functionBody":"var instructions = [];\n\nfor(var i = 0; i < recordList.length; i++) {\n    var createRecord = recordList[i];\n    var instruction = createCreateInstruction(createRecord);\n    instructions.push(instruction);\n}\n\nreturn instructions;","supplementalCode":"","description":"This creates a list of create instructions to go along with a list of records to be created.\n\nThere is the option to assign the ID or to leave it as undefined, in which case\nan automatically incremented ID will be assigned. (For consistency in the data\nset, either all records should be preassigned or all records should be \nautomatically assigned."}},"createCommitBody":{"name":"createCommitBody","type":"apogee.FunctionTable","updateData":{"argList":["instructionList","commitMessage"],"functionBody":"var commit = {};\nvar actions = [];\n\nif(commitMessage.length === 0) throw new Error(\"Commit message missing!\");\n\ncommit.Name = dataSetInfo.name;\ncommit.Message = commitMessage;\ncommit.Actions = actions;\n\n//single action with commits\nvar action = {};\naction.Title = \"bulk create commit\";\naction.Instr = instructionList;\nactions.push(action);\n\nreturn commit","supplementalCode":"","description":"This creates a body for a commit request, given a list of instructions and a commit message."}},"createRequestOptions":{"name":"createRequestOptions","type":"apogee.FunctionTable","updateData":{"argList":["bodyJson","sessionKey"],"functionBody":"var header = {};\nheader[\"Content-Type\"] = \"text/plain;charset=UTF-8\";\nheader.sessionKey = sessionKey;\nheader[\"proto-version\"] = \"4.0\";\nheader[\"db-version\"] = dataSetInfo.version;\n\nrequestInfo = {};\nrequestInfo.header = header;\nrequestInfo.method = \"POST\";\nrequestInfo.body = JSON.stringify(bodyJson);\n\nreturn requestInfo;\n","supplementalCode":"","description":"This creates the requestOptions, suitable for apogee.net.promiseJsonRequest, to go with an type of request to the workingset (micemetarequest) server."}},"host":{"name":"host","type":"apogee.JsonTable","updateData":{"data":"http://localhost:8080/micemetarecipews","description":""}},"commitUrl":{"name":"commitUrl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = host + \"/commit\";\nreturn value;\n\n","supplementalCode":"","description":""}},"requestUrl":{"name":"requestUrl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = host + \"/cannedsearch\";\nreturn value;\n\n","supplementalCode":"","description":""}},"dataSetInfo":{"name":"dataSetInfo","type":"apogee.JsonTable","updateData":{"data":{"records":{"file_entry_type":{"idField":"file_entry_type_id","name":"file_entry_type","foreignList":[{"remoteRecord":"file_entry","name":"file_entry_list","isUnique":false,"remoteField":"file_entry_type_id","restrictDelete":true,"orderField":"ordr"}],"fields":[{"defaultValue":0,"name":"ordr","nullOk":false,"fieldClass":"java.lang.Integer"},{"defaultValue":null,"name":"file_type_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.FileType"},{"defaultValue":null,"name":"section","nullOk":true,"fieldClass":"org.json.JSONArray"},{"defaultValue":null,"name":"key_string","nullOk":false,"fieldClass":"java.lang.String"},{"defaultValue":null,"name":"name","nullOk":false,"fieldClass":"java.lang.String"}],"recordClass":"com.micello.micemetarecipe.data.FileEntryType"},"com_file_entry":{"idField":"com_file_entry_id","name":"com_file_entry","foreignList":[],"fields":[{"defaultValue":0,"name":"ordr","nullOk":false,"fieldClass":"java.lang.Integer"},{"defaultValue":null,"name":"com_file_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.ComFile"},{"defaultValue":null,"name":"meta_file_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.MetaFile"},{"defaultValue":null,"name":"file_group","nullOk":false,"fieldClass":"java.lang.String"}],"recordClass":"com.micello.micemetarecipe.data.ComFileEntry"},"file_type":{"idField":"file_type_id","name":"file_type","foreignList":[{"remoteRecord":"file_entry_type","name":"file_entry_type_list","isUnique":false,"remoteField":"file_type_id","restrictDelete":true,"orderField":"ordr"}],"fields":[{"defaultValue":null,"name":"file_type_name","nullOk":true,"fieldClass":"java.lang.String"}],"recordClass":"com.micello.micemetarecipe.data.FileType"},"file_entry":{"idField":"file_entry_id","name":"file_entry","foreignList":[],"fields":[{"defaultValue":0,"name":"ordr","nullOk":false,"fieldClass":"java.lang.Integer"},{"defaultValue":null,"name":"file_entry_type_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.FileEntryType"},{"defaultValue":null,"name":"entry_context","nullOk":false,"fieldClass":"java.lang.String"},{"defaultValue":null,"name":"option_name","nullOk":false,"fieldClass":"java.lang.String"},{"defaultValue":null,"name":"entry_data","nullOk":false,"fieldClass":"org.json.JSONObject"}],"recordClass":"com.micello.micemetarecipe.data.FileEntry"},"recipe_entry":{"idField":"recipe_entry_id","name":"recipe_entry","foreignList":[],"fields":[{"defaultValue":0,"name":"ordr","nullOk":false,"fieldClass":"java.lang.Integer"},{"defaultValue":null,"name":"meta_file_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.MetaFile"},{"defaultValue":null,"name":"file_entry_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.FileEntry"},{"defaultValue":null,"name":"insertion_info","nullOk":true,"fieldClass":"org.json.JSONObject"}],"recordClass":"com.micello.micemetarecipe.data.RecipeEntry"},"com_file":{"idField":"com_file_id","name":"com_file","foreignList":[{"remoteRecord":"com_file_entry","name":"com_file_entry_list","isUnique":false,"remoteField":"com_file_id","restrictDelete":true,"orderField":"ordr"}],"fields":[{"defaultValue":null,"name":"file_context","nullOk":false,"fieldClass":"java.lang.String"},{"defaultValue":null,"name":"name","nullOk":false,"fieldClass":"java.lang.String"}],"recordClass":"com.micello.micemetarecipe.data.ComFile"},"meta_file":{"idField":"meta_file_id","name":"meta_file","foreignList":[{"remoteRecord":"recipe_entry","name":"recipe_entry_list","isUnique":false,"remoteField":"meta_file_id","restrictDelete":true,"orderField":"ordr"}],"fields":[{"defaultValue":null,"name":"file_type_id","nullOk":false,"fieldClass":"com.micello.micemetarecipe.data.FileType"},{"defaultValue":null,"name":"file_context","nullOk":false,"fieldClass":"java.lang.String"},{"defaultValue":null,"name":"name","nullOk":false,"fieldClass":"java.lang.String"}],"recordClass":"com.micello.micemetarecipe.data.MetaFile"}},"name":"Micemetarecipe","version":"5.0"},"description":""}},"version":{"name":"version","type":"apogee.JsonTable","updateData":{"data":"1.6","description":""}},"createUpdateInstruction":{"name":"createUpdateInstruction","type":"apogee.FunctionTable","updateData":{"argList":["initialRecord","targetRecord"],"functionBody":"if(initialRecord.Id != targetRecord.Id) {\n    throw new Error(\"Record ID mismatch in create update instruction for target record: \" + getRecordErrString(targetRecord));\n}\n\nif(initialRecord.Type != targetRecord.Type) {\n    throw new Error(\"Inital and target record types do not match. Target record: \" + getRecordErrString(targetRecord));\n}\n\nvar recordsDifferent = false;\n\nvar recordInfo = getRecordInfo(initialRecord.Type);\n\nvar instruction = {};\ninstruction.Type = \"Update\";\ninstruction.Record = recordInfo.name;\ninstruction.Id = initialRecord.Id;\n\ninstruction.initialReadPerm = initialRecord.read_perm;\ninstruction.initialEditPerm = initialRecord.edit_perm;\n\nif(initialRecord.readPerm != targetRecord.readPerm) {\n    instruction.targetReadPerm = targetRecord.read_perm;\n    recordsDifferent = true;\n}\n\nif(initialRecord.editPerm != targetRecord.editPerm) {\n    instruction.targetEditPerm = targetRecord.edit_perm;\n    recordsDifferent = true;\n}\n\nvar initialData = {};\ninstruction.Initial = initialData;\nvar targetData = {};\ninstruction.Target = targetData;\n\nfor(var i = 0; i < recordInfo.fields.length; i++) {\n    var field = recordInfo.fields[i];\n    \n    var initialValue;\n    var targetValue;\n    \n    var initialValue = initialRecord.Fields[field.name];\n    var targetValue = targetRecord.Fields[field.name];\n    \n    //validate target values\n    if(targetValue === undefined) {\n        //use default\n        targetValue = field.defaultValue;\n    }\n    \n    if(targetValue === undefined) {\n        throw new Error(\"Unknown problem: undefined field value: \" + getFieldErrString(createRecordInfo,createRecord.Id,field));\n    }\n    \n    if(targetValue === null) {\n        if(!field.nullOk) {\n            throw new Error(\"Illegal null value: \" + getFieldErrString(createRecordInfo,createRecord.Id,field));\n        }\n    }\n    \n    if(!fieldsMatch(initialValue,targetValue,field)) {\n        initialData[field.name] = initialValue;\n        targetData[field.name] = targetValue;\n        recordsDifferent = true;\n    }\n}\n\nif(recordsDifferent) {\n    return instruction;\n}\nelse {\n    return null;\n}\n","supplementalCode":"function fieldsMatch(initialValue,targetValue,fieldInfo) {\n    if(fieldInfo.fieldClass === \"java.lang.String\") {\n        //compare strings with \"==\"\n        return (initialValue == targetValue);\n    }\n    else if(fieldInfo.fieldClass.startsWith(\"java.lang\")) {\n        //compare other basic values with \"===\"\n        return initialValue === targetValue;\n    }\n    else if(fieldInfo.fieldClass.startsWith(\"com.micello\")) {\n        return initialValue === targetValue;\n    }\n    else if(fieldInfo.fieldClass == \"org.json.JSONObject\") {\n        return compareJsonData(initialValue,targetValue);\n    }\n    else if(fieldInfo.fieldClass == \"org.json.JSONArray\") {\n        return compareJsonData(initialValue,targetValue);\n    }\n    else {\n        throw new Error(\"unrecognized field type: \" + fieldInfo.fieldClass);\n    }\n}\n\nfunction compareJsonData(a,b) {\n    var an = apogee.util.getNormalizedObjectCopy(a);\n    var bn = apogee.util.getNormalizedObjectCopy(b);\n    var aString = JSON.stringify(an);\n    var bString = JSON.stringify(bn);\n    return aString == bString;\n}\n    ","description":"This function creates an update instruction given an initial and target record. If the records are the same then NULL is returned. (No update is needed.)"}},"createCreateInstruction":{"name":"createCreateInstruction","type":"apogee.FunctionTable","updateData":{"argList":["createRecord"],"functionBody":"\nvar recordInfo = getRecordInfo(createRecord.Type);\n\nvar instruction = {};\ninstruction.Type = \"Create\";\ninstruction.Record = recordInfo.name;\ninstruction.Id = createRecord.Id;\n\ninstruction.targetReadPerm = createRecord.read_perm;\ninstruction.targetEditPerm = createRecord.edit_perm;\n\nvar targetData = {};\ninstruction.Target = targetData;\n\nfor(var i = 0; i < recordInfo.fields.length; i++) {\n    var field = recordInfo.fields[i];\n    var targetValue;\n    var targetValue = createRecord.Fields[field.name];\n    if(targetValue === undefined) {\n        //use default\n        targetValue = field.defaultValue;\n    }\n    \n    if(targetValue === undefined) {\n        throw new Error(\"Unknown problem: undefined field value: \" + getFieldErrString(createRecord,field));\n    }\n    \n    if(targetValue === null) {\n        if(!field.nullOk) {\n            throw new Error(\"Illegal null value: \" + getFieldErrString(createRecord,field));\n        }\n    }\n    \n    targetData[field.name] = targetValue;\n}\n\nreturn instruction;\n","supplementalCode":"","description":""}},"getFieldErrString":{"name":"getFieldErrString","type":"apogee.FunctionTable","updateData":{"argList":["record","fieldInfo"],"functionBody":"return getRecordErrString(record) + \" - \" + fieldInfo.name;","supplementalCode":"","description":""}},"getRecordErrString":{"name":"getRecordErrString","type":"apogee.FunctionTable","updateData":{"argList":["record"],"functionBody":"return record.Type + \" \" + record.Id;","supplementalCode":"","description":""}},"createDeleteInstruction":{"name":"createDeleteInstruction","type":"apogee.FunctionTable","updateData":{"argList":["deleteRecord"],"functionBody":"\nvar recordInfo = getRecordInfo(deleteRecord.Type);\n\nvar instruction = {};\ninstruction.Type = \"Delete\";\ninstruction.Record = recordInfo.name;\ninstruction.Id = deleteRecord.Id;\n\ninstruction.initialReadPerm = deleteRecord.read_perm;\ninstruction.initialEditPerm = deleteRecord.edit_perm;\n\nvar initialData = {};\ninstruction.Initial = initialData;\n\nfor(var i = 0; i < recordInfo.fields.length; i++) {\n    var field = recordInfo.fields[i];\n    var initialValue = deleteRecord.Fields[field.name];\n    \n    initialData[field.name] = initialValue;\n}\n\nreturn instruction;\n","supplementalCode":"","description":""}},"getRecordInfo":{"name":"getRecordInfo","type":"apogee.FunctionTable","updateData":{"argList":["recordType"],"functionBody":"var recordInfo = dataSetInfo.records[recordType];\n\nif(!recordInfo) {\n    throw new Error(\"Record type not found in getRecordInfo: \" + recordType);\n}\n\nreturn recordInfo;","supplementalCode":"","description":""}},"combinedEntriesToInstructionList":{"name":"combinedEntriesToInstructionList","type":"apogee.FunctionTable","updateData":{"argList":["combinedEntries"],"functionBody":"var output = [];\nfor(var key in combinedEntries) {\n    var entry = combinedEntries[key];\n    var instruction = getInstructionForCombinedEntry(entry);\n    if(instruction) {\n        output.push(instruction);\n    }\n}\n\nreturn output;","supplementalCode":"function getInstructionForCombinedEntry(combinedEntry) {\n    var newEntry = combinedEntry.newEntry;\n    var oldEntry = combinedEntry.oldEntry;\n    \n    if(newEntry) {\n        if(!oldEntry) {\n            console.log(\"Create: \" + newEntry.Id);\n            return createCreateInstruction(newEntry);\n        }\n        else {\n            //this will return null for matching records\n            console.log(\"Update(maybe): \" + newEntry.Id);\n            return createUpdateInstruction(oldEntry,newEntry);\n        }\n    }\n    else if(oldEntry) {\n        console.log(\"Delete: \" + oldEntry.Id);\n        return createDeleteInstruction(oldEntry);\n    }\n    \n    return null;\n}\n\nfunction entriesDifferent(entry1,entry2) {\n    var string1 = JSON.stringify(apogee.util.getNormalizedCopy(entry1));\n    var string2 = JSON.stringify(apogee.util.getNormalizedCopy(entry2));\n    return (string1 == string2);\n}","description":"This function takes a combined entry map of the format:\n\n{\n  \"some-identifier\":{\n    \"oldEntry\":{original record entry, if applicable},\n    \"newEntry\":{new record entry, if applicable}\n  },\n  ...\n}\n\nIt returns an instruction list.\n\n"}},"getCommitPromise":{"name":"getCommitPromise","type":"apogee.FunctionTable","updateData":{"argList":["instructionList","commitMessage","sessionKey"],"functionBody":"var commitBody = createCommitBody(instructionList,commitMessage);\nvar requestOptions = createRequestOptions(commitBody,sessionKey);\nvalue = apogee.net.promiseJsonRequest(commitUrl,requestOptions);\nreturn value;","supplementalCode":"","description":""}},"getRequestPromise":{"name":"getRequestPromise","type":"apogee.FunctionTable","updateData":{"argList":["requestBody","sessionKey"],"functionBody":"var requestOptions = createRequestOptions(requestBody,sessionKey);\nvalue = apogee.net.promiseJsonRequest(requestUrl,requestOptions);\nreturn value;","supplementalCode":"","description":""}}}},"taskResults":{"name":"taskResults","type":"apogee.Folder","children":{"submit":{"name":"submit","type":"apogee.JsonTable","updateData":{"data":{"state":"INCOMPLETE"},"description":""}},"editMetaFile":{"name":"editMetaFile","type":"apogee.JsonTable","updateData":{"data":{"state":"INCOMPLETE"},"description":""}},"loadMetaFileRecords":{"name":"loadMetaFileRecords","type":"apogee.JsonTable","updateData":{"data":{"state":"INCOMPLETE"},"description":""}},"login":{"name":"login","type":"apogee.JsonTable","updateData":{"data":{"state":"INCOMPLETE"},"description":""}},"loadContext":{"name":"loadContext","type":"apogee.JsonTable","updateData":{"data":{"state":"INCOMPLETE"},"description":""}}}},"tasks":{"name":"tasks","type":"apogee.Folder","children":{"login":{"name":"login","type":"apogee.Folder","children":{"loginUrl":{"name":"loginUrl","type":"apogee.JsonTable","updateData":{"data":"http://localhost:8080/TestAuthorization/loginjson","description":""}},"loginControl":{"name":"loginControl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"return loginUrl;","supplementalCode":"","description":""}},"sessionResponse":{"name":"sessionResponse","type":"apogee.JsonTable","updateData":{"data":{"sessionKey":"SESS0f6c4c2238a670b8138b63d9fd03cc22=37f800i4drfu5ib7c2jbuh01d7","responseCode":1},"description":""}},"taskResult":{"name":"taskResult","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\nvar sessionKey;\nif(!sessionResponse) {\n    output.state = \"INCOMPLETE\";\n}\nelse if(sessionResponse.responseCode === 1) {\n    output.state = \"SUCCESS\";\n    data = {};\n    data.sessionKey = sessionResponse.sessionKey;\n    output.data = data;\n}\nelse {\n    output.status = \"ERROR\";\n    output.msg = sessionResponse.message;\n\n}\n\napogeeMessenger.dataUpdate(\"taskResults.login\",output);\n    \nreturn output;","supplementalCode":"","description":""}}}},"loadMetaFileRecords":{"name":"loadMetaFileRecords","type":"apogee.Folder","children":{"fileTypeList":{"name":"fileTypeList","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(!sessionKey) return null;\n\nvar fileTypeSearch = {};\nfileTypeSearch.search = \"file_type_list\";\n\nreturn micemetarecipeDataAccess.getRequestPromise(fileTypeSearch,sessionKey);\n\n","supplementalCode":"","description":""}},"fileTypeEntryList":{"name":"fileTypeEntryList","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(!sessionKey) return null;\nif(!fileSelection)  return null;\n\nvar fileTypeId;\nif(fileSelection.editExisting) {\n    if(existingMetaFileEntry) {\n        fileTypeId = existingMetaFileEntry.Fields.file_type_id;\n    }\n    else {\n        return null;\n    }\n}\nelse {\n    fileTypeId = fileSelection.fileTypeId;\n}\n\nvar searchDef = {};\nsearchDef.search = \"file_type_entries\";\nsearchDef.id = fileTypeId;\n\nreturn micemetarecipeDataAccess.getRequestPromise(searchDef,sessionKey);\n\n","supplementalCode":"","description":""}},"recordStore":{"name":"recordStore","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var map = {};\n\naddSearchResponse(fileTypeList,map);\naddSearchResponse(fileTypeEntryList,map);\naddSearchResponse(metaFileList,map);\naddSearchResponse(metaFileResponse,map);\n\nreturn map;\n\n","supplementalCode":"function addSearchResponse(searchResponse,outputMap) {\n    if(!searchResponse) {\n        return;\n    }\n    \n    if(!searchResponse.success) {\n        throw new Error(\"Error in loading record data: \" + searchResponse.msg);\n    }\n    \n    var searchResponseData = searchResponse.data;\n    \n    if(searchResponseData.Response) {\n        addRecordList(searchResponseData.Response,outputMap);\n    }\n    if(searchResponseData.Records) {\n        addRecordList(searchResponseData.Records,outputMap);\n    }\n    \n}\n\nfunction addRecordList(recordList,outputMap) {\n    for(var i = 0; i < recordList.length; i++) {\n        var record = recordList[i];\n        \n        var typeSection = outputMap[record.Type];\n        if(!typeSection) {\n            typeSection = {};\n            outputMap[record.Type] = typeSection;\n        }\n        \n        //if there is already a record, just overwrite it. They should be the same.\n        typeSection[record.Id] = record;\n    }\n}","description":""}},"metaFileResponse":{"name":"metaFileResponse","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(!sessionKey) return null;\nif(!fileSelection) return null;\n\n\nif(fileSelection.editExisting) {\n    var searchDef = {};\n    searchDef.search = \"meta_file\";\n    searchDef.id = fileSelection.metaFileId;\n    return micemetarecipeDataAccess.getRequestPromise(searchDef,sessionKey);\n}\nelse {\n    return null;\n}\n\n\n\n\n\n","supplementalCode":"","description":""}},"metaFileList":{"name":"metaFileList","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(!sessionKey) return null;\nif(!context) return null;\n\n\nvar searchDef = {};\nsearchDef.search = \"meta_file_list\";\nsearchDef.file_context = context;\n\nreturn micemetarecipeDataAccess.getRequestPromise(searchDef,sessionKey);\n\n","supplementalCode":"","description":""}},"getRecord":{"name":"getRecord","type":"apogee.FunctionTable","updateData":{"argList":["recordType","recordId"],"functionBody":"typeSection = recordStore[recordType];\nif(!typeSection) {\n    throw new Error(\"Type not found!\");\n}\n\nreturn typeSection[recordId];\n","supplementalCode":"","description":""}},"metaFileSelector":{"name":"metaFileSelector","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nif((fileTypeList)&&(fileTypeList.success)) {\n    var fileTypes = {};\n    output.fileTypes = fileTypes;\n\n    var fileTypeRecords = fileTypeList.data.Response;\n    for(var i = 0; i < fileTypeRecords.length; i++) {\n        var record = fileTypeRecords[i];\n        fileTypes[record.Fields.file_type_name] = record.Id;\n    }\n}\n\nif((metaFileList)&&(metaFileList.success)) {\n    var metaFiles = {};\n    output.metaFiles = metaFiles;\n    \n    var metaFileRecords = metaFileList.data.Response;\n    for(var i = 0; i < metaFileRecords.length; i++) {\n        var record = metaFileRecords[i];\n        var fileTypeRecord = getRecord(\"file_type\",record.Fields.file_type_id);\n        var fileType = fileTypeRecord.Fields.file_type_name;\n        var metaName = record.Fields.name;\n        metaFiles[fileType + \":\" + metaName] = record.Id;\n    }\n}\n\noutput.currentMetaFileId = metaFileId;\noutput.currentFileTypeId = fileTypeId;\noutput.editExisting = fileSelection ? fileSelection.editExisting : false;\n\nreturn output;","supplementalCode":"","description":""}},"INVALID_ID":{"name":"INVALID_ID","type":"apogee.JsonTable","updateData":{"data":0,"description":""}},"fileSelection":{"name":"fileSelection","type":"apogee.JsonTable","updateData":{"data":{"editExisting":true,"metaFileId":9},"description":""}},"availableFileEntries":{"name":"availableFileEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nvar recordStore = loadMetaFileRecords.recordStore;\nfor(var idString in recordStore.file_entry) {\n    var fileEntry = recordStore.file_entry[idString];\n    var fileTypeEntry = loadMetaFileRecords.getRecord(\"file_entry_type\",fileEntry.Fields.file_entry_type_id);\n    var entry = {};\n    entry.fileEntry = fileEntry;\n    entry.fileTypeEntry = fileTypeEntry;\n    entry.recipeEntry = existingRecipeEntries[idString];\n    output[idString] = entry;\n}\n\nreturn output;","supplementalCode":"","description":""}},"existingMetaFileEntry":{"name":"existingMetaFileEntry","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(!loadMetaFileRecords.metaFileResponse) {\n    return false;\n}\n\nif(!loadMetaFileRecords.metaFileResponse.success) {\n    throw new Error(\"Meta File request error\");\n}\n\nif(loadMetaFileRecords.metaFileResponse.data.Response.length === 0) {\n    throw new Error(\"Meta file not found\");\n}\n\nreturn loadMetaFileRecords.metaFileResponse.data.Response[0];","supplementalCode":"","description":""}},"existingRecipeEntries":{"name":"existingRecipeEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nif(!metaFileResponse) {\n    return output;\n}\n\nif(!metaFileResponse.success) {\n    throw new Error(\"Error loading meta file records: \" + loadMetaFileRecords.meatFileResponse.msg);\n}\n\nvar metaFileRecords = metaFileResponse.data.Records;\n\nfor(var i = 0; i < metaFileRecords.length; i++) {\n    var record = metaFileRecords[i];\n    if(record.Type == \"recipe_entry\") {\n        output[record.Fields.file_entry_id] = record;\n    }\n}\n\nreturn output;","supplementalCode":"","description":""}},"activeMetaFileEntry":{"name":"activeMetaFileEntry","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(loadMetaFileRecords.fileSelection.editExisting) {\n    return existingMetaFileEntry;\n}\nelse {\n    var fields = {};\n    fields.name = loadMetaFileRecords.fileSelection.metaFileName;\n    fields.file_type_id = loadMetaFileRecords.fileSelection.fileTypeId;\n    fields.file_context = loadMetaFileRecords.context;\n\n    var recordInfo =  micemetarecipeDataAccess.getRecordInfo(\"meta_file\");\n    return micemetarecipeDataAccess.createRecord(recordInfo,fields);\n}\n","supplementalCode":"","description":""}},"storeDataFlag":{"name":"storeDataFlag","type":"apogee.JsonTable","updateData":{"data":false,"description":""}},"taskResult":{"name":"taskResult","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nif(!dataLoadSuccess) {\n    output.state = \"INCOMPLETE\";\n}\nelse if(dataLoadSuccess.success === true) {\n    output.state = \"SUCCESS\";\n    data = {};\n    data.availableFileEntries = availableFileEntries;\n    data.existingMetaFileEntry = existingMetaFileEntry;\n    data.existingRecipeEntries = existingRecipeEntries;\n    data.activeMetaFileEntry = activeMetaFileEntry;\n    output.data = data;\n}\nelse if(dataLoadErrors.success === false) {\n    output.state = \"ERROR\";\n    output.msg = dataLoadErrors.msg;\n}\n\nif(storeDataFlag) {\n    var updateInfo = [];\n    var updateEntry;\n    \n    updateEntry = {};\n    updateEntry.memberName = \"taskResults.loadMetaFileRecords\";\n    updateEntry.data = output;\n    updateInfo.push(updateEntry);\n    \n    updateEntry = {};\n    updateEntry.memberName = \"storeDataFlag\";\n    updateEntry.data = false;\n    updateInfo.push(updateEntry);\n    \n    apogeeMessenger.compoundDataUpdate(updateInfo);\n}\n\nreturn output;\n\n","supplementalCode":"","description":""}},"dataLoadSuccess":{"name":"dataLoadSuccess","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if((!fileTypeList)&&(!metaFileResponse)) {\n    return null;\n}\n\nvar output = {};\n\nerrors = [];\nif(fileTypeEntryList.success !== true) {\n    errors.push(fileTypeEntryList.msg);\n}\nif(metaFileResponse.success !== true) {\n    errors.push(metaFileResponse.msg);\n}\n\nif(errors.length > 0) {\n    output.success = false;\n    output.msg = errors.join(\"; \");\n}\nelse {\n    output.success = true;\n}\n\nreturn output;","supplementalCode":"","description":""}},"context":{"name":"context","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadContext.state == \"SUCCESS\") {\n    return taskResults.loadContext.data.context;\n}\nelse {\n    return null;\n}","supplementalCode":"","description":""}},"sessionKey":{"name":"sessionKey","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.login.state == \"SUCCESS\") {\n    return taskResults.login.data.sessionKey;\n}\nelse {\n    return null;\n}","supplementalCode":"","description":""}}}},"editMetaFile":{"name":"editMetaFile","type":"apogee.Folder","children":{"selectEntriesControl":{"name":"selectEntriesControl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var data = {};\ndata.available = initialFileEntries;\ndata.selected = selectedFileEntries;\ndata.existing = initialRecipeEntries;\ndata.metaFileId = selectedMetaFileEntry ? selectedMetaFileEntry.Id : loadMetaFileRecords.INVALID_ID;\nreturn data;","supplementalCode":"","description":""}},"selectedFileEntries":{"name":"selectedFileEntries","type":"apogee.JsonTable","updateData":{"data":{"2756":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"Academic Building"},"ordr":0,"entry_context":"public","option_name":"Standard","file_entry_type_id":2392},"edit_ok":true,"read_perm":2,"Id":2756},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:Academic Building","ordr":0,"name":"com_type:Academic Building","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2392},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":2756,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3942}},"2757":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"Airport"},"ordr":1,"entry_context":"public","option_name":"Standard","file_entry_type_id":2393},"edit_ok":true,"read_perm":2,"Id":2757},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:Airport","ordr":1,"name":"com_type:Airport","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2393},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":2757,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3943}},"2758":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"Apartment Complex"},"ordr":2,"entry_context":"public","option_name":"Standard","file_entry_type_id":2394},"edit_ok":true,"read_perm":2,"Id":2758},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:Apartment Complex","ordr":2,"name":"com_type:Apartment Complex","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2394},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":2758,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3944}},"2759":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"Bus Station"},"ordr":3,"entry_context":"public","option_name":"Standard","file_entry_type_id":2395},"edit_ok":true,"read_perm":2,"Id":2759},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:Bus Station","ordr":3,"name":"com_type:Bus Station","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2395},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":2759,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3945}},"2760":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"Business Campus"},"ordr":4,"entry_context":"public","option_name":"Standard","file_entry_type_id":2396},"edit_ok":true,"read_perm":2,"Id":2760},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:Business Campus","ordr":4,"name":"com_type:Business Campus","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2396},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":2760,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3946}},"2761":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"Campground"},"ordr":5,"entry_context":"public","option_name":"Standard","file_entry_type_id":2397},"edit_ok":true,"read_perm":2,"Id":2761},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:Campground","ordr":5,"name":"com_type:Campground","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2397}},"2767":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"High School"},"ordr":11,"entry_context":"public","option_name":"Standard","file_entry_type_id":2403},"edit_ok":true,"read_perm":2,"Id":2767},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"com_type:High School","ordr":11,"name":"com_type:High School","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2403},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":2767,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3947}},"3016":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"ATM"},"ordr":260,"entry_context":"public","option_name":"Standard","file_entry_type_id":2652},"edit_ok":true,"read_perm":2,"Id":3016},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"icon:ATM","ordr":260,"name":"icon:ATM","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2652},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":3016,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3948}},"3017":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"ATM"},"ordr":261,"entry_context":"public","option_name":"Standard","file_entry_type_id":2653},"edit_ok":true,"read_perm":2,"Id":3017},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"icon:ATM:Dollar","ordr":261,"name":"icon:ATM:Dollar","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2653},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":3017,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3949}},"3019":{"fileEntry":{"edit_perm":15,"Type":"file_entry","Fields":{"entry_data":{"lang":"en","trans":"ATM"},"ordr":263,"entry_context":"public","option_name":"Standard","file_entry_type_id":2655},"edit_ok":true,"read_perm":2,"Id":3019},"fileTypeEntry":{"edit_perm":15,"Type":"file_entry_type","Fields":{"key_string":"icon:ATM:Yen","ordr":263,"name":"icon:ATM:Yen","file_type_id":6,"section":["en"]},"edit_ok":true,"read_perm":2,"Id":2655},"recipeEntry":{"edit_perm":15,"Type":"recipe_entry","Fields":{"ordr":0,"meta_file_id":9,"file_entry_id":3019,"insertion_info":null},"edit_ok":true,"read_perm":2,"Id":3951}}},"description":""}},"initialFileEntries":{"name":"initialFileEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\n    return taskResults.loadMetaFileRecords.data.availableFileEntries;\n}\nelse {\n    return null;\n}","supplementalCode":"","description":""}},"initialRecipeEntries":{"name":"initialRecipeEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\n    return taskResults.loadMetaFileRecords.data.existingRecipeEntries;\n}\nelse {\n    return null;\n}","supplementalCode":"","description":""}},"selectedMetaFileEntry":{"name":"selectedMetaFileEntry","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\n    return taskResults.loadMetaFileRecords.data.selectedMetaFileEntry;\n}\nelse {\n    return null;\n}","supplementalCode":"","description":""}}}},"submit":{"name":"submit","type":"apogee.Folder","children":{"submitControl":{"name":"submitControl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"return instructionList;","supplementalCode":"","description":""}},"newRecipeEntries":{"name":"newRecipeEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nfor(var fileIdString in selectedFileEntries) {\n    var selectedEntry = selectedFileEntries[fileIdString];\n    var recipeEntry = selectedEntry.recipeEntry;\n    if(!recipeEntry) {\n        recipeEntry = createNewRecipeEntry(selectedEntry.fileEntry);\n    }\n    \n    output[recipeEntry.Id] = recipeEntry;\n}\n\nreturn output;","supplementalCode":"function createNewRecipeEntry(fileEntry) {\n    var order = 0;\n    \n    var fields = {};\n    fields.ordr = order;\n    fields.meta_file_id = selectedMetaFileEntry.Id;\n    fields.file_entry_id = fileEntry.Id;\n    fields.insertionInfo = null;\n    \n    var recipeRecordInfo = micemetarecipeDataAccess.getRecordInfo(\"recipe_entry\");\n    return micemetarecipeDataAccess.createRecord(recipeRecordInfo,fields);\n}","description":""}},"instructionList":{"name":"instructionList","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(!combinedEntries) return null;\n\nreturn micemetarecipeDataAccess.combinedEntriesToInstructionList(combinedEntries);","supplementalCode":"","description":""}},"commitResponse":{"name":"commitResponse","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if((!liveInstructionList)||(liveInstructionList.length == 0)) {\n    return null; \n}\n\nreturn micemetarecipeDataAccess.getCommitPromise(liveInstructionList,commitMessage,sessionKey);","supplementalCode":"","description":""}},"combinedEntries":{"name":"combinedEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nvar outEntry;\nvar outIdString;\n\n//add the meta file entries\nif(selectedMetaFileEntry) {\n    outEntry = {};\n    outIdString = getOutputId(selectedMetaFileEntry);\n    output[outIdString] = outEntry;\n    outEntry.newEntry = selectedMetaFileEntry;\n    if(initialMetaFileEntry) {\n        outEntry.oldEntry = initialMetaFileEntry;\n    }\n}\n\n//add the recipe entries\nvar recipeIdString;\nvar recipeEntry;\nfor(recipeIdString in newRecipeEntries) {\n    recipeEntry = newRecipeEntries[recipeIdString];\n    \n    outIdString = getOutputId(recipeEntry);\n    outEntry = {};\n    outEntry.newEntry = recipeEntry\n    output[outIdString] = outEntry;\n}\n\nfor(recipeIdString in initialRecipeEntries) {\n    recipeEntry = initialRecipeEntries[recipeIdString];\n    \n    outIdString = getOutputId(recipeEntry);\n    var outEntry = output[outIdString];\n    if(!outEntry) {\n        outEntry = {};\n        output[outIdString] = outEntry;\n    }\n    outEntry.oldEntry = recipeEntry;\n}\n\nreturn output;\n","supplementalCode":"function getOutputId(record) {\n    return record.Type + \"-\" + record.Id;\n}","description":""}},"commitMessage":{"name":"commitMessage","type":"apogee.JsonTable","updateData":{"data":null,"description":""}},"liveInstructionList":{"name":"liveInstructionList","type":"apogee.JsonTable","updateData":{"data":null,"description":""}},"taskResult":{"name":"taskResult","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"//only process the commit response if there are\n//live instructions\nif(!liveInstructionList) return \"OK\";\n\nvar taskResult = {};\nif(!commitResponse) {\n    taskResult.state = \"INCOMPLETE\";\n}\nelse if(commitResponse.success === true) {\n    taskResult.state = \"SUCCESS\";\n}\nelse {\n    taskResult.status = \"ERROR\";\n    taskResult.msg = commitResponse.msg;\n}\n\nvar commitResult = {};\ncommitResult.commitMessage = commitMessage;\ncommitResult.commitResponse = commitResponse;\ntaskResult.data = commitResult;\n\nvar updateInfo = [];\nvar updateEntry;\n\n//publish the result\nupdateEntry = {};\nupdateEntry.memberName = \"taskResults.submit\";\nupdateEntry.data = taskResult;\nupdateInfo.push(updateEntry);\n\n//clear the temporary fields\nupdateEntry = {};\nupdateEntry.memberName = \"liveInstructionList\";\nupdateEntry.data = null;\nupdateInfo.push(updateEntry);\n\nupdateEntry = {};\nupdateEntry.memberName = \"commitMessage\";\nupdateEntry.data = null;\nupdateInfo.push(updateEntry);\n\n//set data\napogeeMessenger.compoundDataUpdate(updateInfo);\n    \nreturn \"OK\";","supplementalCode":"","description":""}},"initialMetaFileEntry":{"name":"initialMetaFileEntry","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\n    return taskResults.loadMetaFileRecords.data.existingMetaFileEntry;\n}\nelse {\n    return null;\n}","supplementalCode":"","description":""}},"selectedFileEntries":{"name":"selectedFileEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.editMetaFile.state == \"SUCCESS\") {\r\n    return taskResults.editMetaFile.data.selectedFileEntries;\r\n}\r\nelse {\r\n    return null;\r\n}","supplementalCode":"","description":""}},"initialRecipeEntries":{"name":"initialRecipeEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\r\n    return taskResults.loadMetaFileRecords.data.existingRecipeEntries;\r\n}\r\nelse {\r\n    return null;\r\n}","supplementalCode":"","description":""}},"selectedMetaFileEntry":{"name":"selectedMetaFileEntry","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\r\n    return taskResults.loadMetaFileRecords.data.activeMetaFileEntry;\r\n}\r\nelse {\r\n    return null;\r\n}","supplementalCode":"","description":""}},"initialFileEntries":{"name":"initialFileEntries","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(taskResults.loadMetaFileRecords.state == \"SUCCESS\") {\r\n    return taskResults.loadMetaFileRecords.data.availableFileEntries;\r\n}\r\nelse {\r\n    return null;\r\n}","supplementalCode":"","description":""}}}},"loadContext":{"name":"loadContext","type":"apogee.Folder","children":{"contextControl":{"name":"contextControl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"return null;","supplementalCode":"","description":""}}}}}}}}},"components":{"micemetarecipeDataAccess":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":216,"y":34}},"children":{"createRecord":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":560,"height":321},"posInfo":{"x":32,"y":389},"state":-1,"viewType":"Code"}},"recordsToCreateInstructions":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":834,"height":391},"posInfo":{"x":30,"y":472},"state":-1,"viewType":"Code"}},"createCommitBody":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":568,"height":400},"posInfo":{"x":629,"y":225},"state":-1,"viewType":"Code"}},"createRequestOptions":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":523,"height":254},"posInfo":{"x":628,"y":179},"state":-1,"viewType":"Code"}},"host":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":353,"height":71},"posInfo":{"x":14,"y":15},"state":-1,"viewType":"Text"}},"commitUrl":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":433,"height":107},"posInfo":{"x":14,"y":98},"state":-1,"viewType":"Text"}},"requestUrl":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":450,"height":68},"posInfo":{"x":14,"y":57},"state":-1,"viewType":"Text"}},"dataSetInfo":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":665,"height":611},"posInfo":{"x":818,"y":386},"state":-1,"viewType":"Text"}},"version":{"type":"apogeeapp.app.TextComponent","windowState":{"sizeInfo":{"width":197,"height":91},"posInfo":{"x":523,"y":367},"state":0,"viewType":"Text"}},"createUpdateInstruction":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":886,"height":655},"posInfo":{"x":0,"y":210},"state":0,"viewType":"Code"}},"createCreateInstruction":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":994,"height":643},"posInfo":{"x":35,"y":209},"state":-1,"viewType":"Code"}},"getFieldErrString":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":512,"height":68},"posInfo":{"x":761,"y":616},"state":-1,"viewType":"Code"}},"getRecordErrString":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":400,"height":81},"posInfo":{"x":762,"y":664},"state":-1,"viewType":"Code"}},"createDeleteInstruction":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":678,"height":540},"posInfo":{"x":33,"y":305},"state":0,"viewType":"Code"}},"getRecordInfo":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":480,"height":400},"posInfo":{"x":818,"y":427},"state":-1,"viewType":"Code"}},"combinedEntriesToInstructionList":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":721,"height":524},"posInfo":{"x":176,"y":519},"state":0,"viewType":"Private"}},"getCommitPromise":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":741,"height":400},"posInfo":{"x":374,"y":75},"state":-1,"viewType":"Code"}},"getRequestPromise":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":810,"height":400},"posInfo":{"x":376,"y":27},"state":-1,"viewType":"Code"}}}},"taskResults":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":34,"y":95}},"children":{"submit":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":298,"height":94},"posInfo":{"x":32,"y":481},"state":-1,"viewType":"Text"}},"editMetaFile":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":321,"height":94},"posInfo":{"x":32,"y":263},"state":-1,"viewType":"Text"}},"loadMetaFileRecords":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":321,"height":93},"posInfo":{"x":31,"y":365},"state":-1,"viewType":"Text"}},"login":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":339,"height":104},"posInfo":{"x":30,"y":15},"state":-1,"viewType":"Text"}},"loadContext":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":335,"height":125},"posInfo":{"x":32,"y":126},"state":-1,"viewType":"Text"}}}},"tasks":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":37,"y":37}},"children":{"login":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":75,"y":75}},"children":{"loginUrl":{"type":"apogeeapp.app.TextComponent","windowState":{"sizeInfo":{"width":463,"height":86},"posInfo":{"x":26,"y":27},"state":0,"viewType":"Text"}},"loginControl":{"type":"apogeeapp.app.CustomControlComponent","windowState":{"sizeInfo":{"width":404,"height":129},"posInfo":{"x":27,"y":147},"state":0,"viewType":"Output"},"resource":{"html":"","css":"","setData":"this.loginUrl = data;","constructorAddition":"\n\n//this uses the updated version of test authorization that takes and returns a JSON\nthis.onClick = function() {\n    \n    //get the output table\n    var outputTableName = \"sessionResponse\";\n    var fromMember = mode.getMember();\n    \n    //on click\n    var bodyJson = {};\n    bodyJson.userName = resource.userInput.value;\n    bodyJson.password = resource.passwordInput.value;\n    \n    //cleaer password field\n    resource.passwordInput.value = \"\";\n    \n    var options = {};\n    options.body = JSON.stringify(bodyJson);\n    options.method = \"POST\";\n    \n    var requestPromise = apogee.net.promiseJsonRequest(this.loginUrl,options);\n    apogee.action.asynchDataUpdate(outputTableName,fromMember,requestPromise);\n}","init":"\nvar label1 = document.createElement(\"label\");\nlabel1.for = \"commitMessageInput\";\nlabel1.innerHTML = \"User:\"\nelement.appendChild(label1);\n\nvar input1 = document.createElement(\"input\");\ninput1.id = \"userInput\";\nresource.userInput = input1;\nelement.appendChild(input1);\n\nelement.appendChild(document.createElement(\"br\"));\n\nvar label2 = document.createElement(\"label\");\nlabel2.for = \"commitMessageInput\";\nlabel2.innerHTML = \"Password:\"\nelement.appendChild(label2);\n\nvar input2 = document.createElement(\"input\");\ninput2.id = \"passwordInput\";\nresource.passwordInput = input2;\nelement.appendChild(input2);\n\nelement.appendChild(document.createElement(\"br\"));\n\nvar button = document.createElement(\"button\");\nbutton.innerHTML = \"Login\";\nelement.appendChild(button);\n\nvar instance = this;\nbutton.onclick = function() {\n    instance.onClick();\n}\n\n\n"}},"sessionResponse":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":697,"height":121},"posInfo":{"x":26,"y":306},"state":0,"viewType":"Text"}},"taskResult":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":672,"height":147},"posInfo":{"x":30,"y":458},"state":0,"viewType":"Text"}}}},"loadMetaFileRecords":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":66,"y":121}},"children":{"fileTypeList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":555,"height":325},"posInfo":{"x":296,"y":149},"state":-1,"viewType":"Formula"}},"fileTypeEntryList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":405,"height":473},"posInfo":{"x":613,"y":41},"state":-1,"viewType":"Text"}},"recordStore":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":762,"height":549},"posInfo":{"x":280,"y":606},"state":-1,"viewType":"Private"}},"metaFileResponse":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":799,"height":449},"posInfo":{"x":609,"y":143},"state":-1,"viewType":"Text"}},"metaFileList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":560,"height":289},"posInfo":{"x":23,"y":150},"state":-1,"viewType":"Formula"}},"getRecord":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":488,"height":179},"posInfo":{"x":281,"y":651},"state":-1,"viewType":"Code"}},"metaFileSelector":{"type":"apogeeapp.app.CustomControlComponent","windowState":{"sizeInfo":{"width":538,"height":194},"posInfo":{"x":20,"y":226},"state":0,"viewType":"Output"},"resource":{"html":"<input type=\"radio\" value=\"create\" name=\"createUpdate\" id=\"load_createRadio\">Create</input>\n<input type=\"radio\" value=\"update\" name=\"createUpdate\" id=\"load_updateRadio\">Update</input>\n<br><br>\n<select id=\"load_metaFileSelect\"></select>\n<select id=\"load_fileTypeSelect\"></select>\n<br><br>\n<div id=\"load_metaFilePanel\">\nMeta File Name: <input type=\"text\" id=\"load_metaFileNameInput\"></input>\n<br><br>\n</div>\n<input type=\"button\" value=\"Submit\" id=\"load_submitButton\"></input>","onLoad":"this.createRadio = document.getElementById(\"load_createRadio\");\nthis.updateRadio = document.getElementById(\"load_updateRadio\");\nthis.selectMetaFileElement = document.getElementById(\"load_metaFileSelect\");\nthis.selectFileTypeElement = document.getElementById(\"load_fileTypeSelect\");\nthis.metaFilePanel = document.getElementById(\"load_metaFilePanel\");\nthis.metaFileNameInput = document.getElementById(\"load_metaFileNameInput\");\nthis.submitButton = document.getElementById(\"load_submitButton\");\n\nvar instance = this;\nthis.submitButton.onclick = function() {\n    instance.onSubmitClick();\n}\n\nvar onRadioClick = function() {\n    instance.onRadioClick();\n}\n\nthis.createRadio.onclick = onRadioClick;\nthis.updateRadio.onclick = onRadioClick;\n\nthis.initialized = true;","setData":"if(!data) return;\nif(!this.initialized) return;\n\nthis.editExisting = data.editExisting;\n\nvar INVALID_ID = 0;\n\nif(this.selectMetaFileElement) {\n\n    apogeeapp.ui.removeAllChildren(this.selectMetaFileElement);\n    \n    //add a dummy entry\n    var option = document.createElement(\"option\");\n    option.text = \"<none selected>\";\n    \n    option.value = INVALID_ID;\n    if(INVALID_ID == data.currentMetaFileId) option.selected = true;\n    this.selectMetaFileElement.add(option);\n    \n    for(var fileDesc in data.metaFiles) {\n        var id = data.metaFiles[fileDesc];\n        var option = document.createElement(\"option\");\n        option.text = fileDesc;\n        option.value = id;\n        if(id == data.currentMetaFileId) option.selected = true;\n        this.selectMetaFileElement.add(option);\n    }\n}\n\nif(this.selectFileTypeElement) {\n    console.log(\"current id: \" + data.currentFileTypeId);\n\n    apogeeapp.ui.removeAllChildren(this.selectFileTypeElement);\n    \n    //add a dummy entry\n    var option = document.createElement(\"option\");\n    option.text = \"<none selected>\";\n    option.value = INVALID_ID;\n    if(INVALID_ID == data.currentFileTypeId) option.selected = true;\n    console.log(\"adding id: \" + INVALID_ID);\n    \n    this.selectFileTypeElement.add(option);\n    \n    for(var fileDesc in data.fileTypes) {\n        var id = data.fileTypes[fileDesc];\n        var option = document.createElement(\"option\");\n        option.text = fileDesc;\n        option.value = id;\n        if(id == data.currentFileTypeId) option.selected = true;\n        console.log(\"adding id: \" + id);\n        this.selectFileTypeElement.add(option);\n    }\n}\n\nthis.updateUiForCreateUpdate(data.editExisting);\n","constructorAddition":"\nthis.onSubmitClick = function() {\n    \n    var selectElement = this.editExisting ? this.selectMetaFileElement : this.selectFileTypeElement;\n    \n    if(!selectElement) {\n        alert(\"Error; UI not initialized\");\n        return;\n    }\n    \n    if(selectElement.length === 0) {\n        alert(\"Invalid selection!\");\n        return;\n    }\n    \n    var selectedIdString = selectElement.value;\n    if(!isFinite(selectedIdString)) {\n        alert(\"Invalid selection!\");\n        return;\n    }\n    var selectedId = Number(selectedIdString);\n\n    if(!this.editExisting) {\n        var metaFileName = this.metaFileNameInput.value.trim();\n        if((!metaFileName)||(metaFileName.length === 0)) {\n            alert(\"Invalid meta file name!\");\n            return;\n        }\n    }\n    \n    var fileSelection = {};\n    fileSelection.editExisting = this.editExisting;\n    if(this.editExisting) {\n        fileSelection.metaFileId = selectedId;\n    }\n    else {\n        fileSelection.fileTypeId = selectedId;\n        fileSelection.metaFileName = metaFileName;\n    }\n    \n    //create the compound update\n    var updateInfo = [];\n    var updateEntry;\n    \n    updateEntry = {};\n    updateEntry.memberName = \"fileSelection\";\n    updateEntry.data = fileSelection;\n    updateInfo.push(updateEntry);\n    \n    updateEntry = {};\n    updateEntry.memberName = \"storeDataFlag\";\n    updateEntry.data = true;\n    updateInfo.push(updateEntry);\n    \n    var messenger = mode.getMessenger();\n    messenger.compoundDataUpdate(updateInfo);\n}\n\nthis.onRadioClick = function() {\n    var editExisting = this.updateRadio.checked;\n    this.updateUiForCreateUpdate(editExisting);\n}\n\nthis.updateUiForCreateUpdate = function(editExisting) {\n    this.editExisting = editExisting;\n    \n    if(this.selectFileTypeElement) {\n        this.selectFileTypeElement.style.display = editExisting ? \"none\" : \"\";\n    }\n    if(this.selectMetaFileElement) {\n        this.selectMetaFileElement.style.display = editExisting ? \"\" : \"none\";\n    }\n    if(this.metaFilePanel) {\n        this.metaFilePanel.style.display = editExisting ? \"none\" : \"\";\n    }\n    \n    var createRadioSelected = !editExisting;\n    var updateRadioSelected = editExisting;\n    \n    if((this.createRadio)&&(this.createRadio.checked != createRadioSelected)) {\n        this.createRadio.checked = createRadioSelected;\n    }\n    if((this.updateRadio)&&(this.updateRadio.checked != updateRadioSelected)) {\n        this.updateRadio.checked = updateRadioSelected;\n    }\n}\n\n"}},"INVALID_ID":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":220,"height":70},"posInfo":{"x":14,"y":615},"state":0,"viewType":"Text"}},"fileSelection":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":270,"height":102},"posInfo":{"x":17,"y":448},"state":0,"viewType":"Text"}},"availableFileEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":470,"height":320},"posInfo":{"x":892,"y":38},"state":-1,"viewType":"Formula"}},"existingMetaFileEntry":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":621,"height":393},"posInfo":{"x":889,"y":139},"state":-1,"viewType":"Formula"}},"existingRecipeEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":838,"height":423},"posInfo":{"x":888,"y":191},"state":-1,"viewType":"Formula"}},"activeMetaFileEntry":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":707,"height":420},"posInfo":{"x":886,"y":244},"state":-1,"viewType":"Formula"}},"storeDataFlag":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":241,"height":89},"posInfo":{"x":313,"y":448},"state":0,"viewType":"Text"}},"taskResult":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":944,"height":639},"posInfo":{"x":893,"y":438},"state":-1,"viewType":"Formula"}},"dataLoadSuccess":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":610,"height":352},"posInfo":{"x":885,"y":336},"state":-1,"viewType":"Formula"}},"context":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":235,"height":99},"posInfo":{"x":302,"y":18},"state":0,"viewType":"Text"}},"sessionKey":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":259,"height":102},"posInfo":{"x":23,"y":14},"state":0,"viewType":"Text"}}}},"editMetaFile":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":73,"y":241}},"children":{"selectEntriesControl":{"type":"apogeeapp.app.CustomControlComponent","windowState":{"sizeInfo":{"width":737,"height":678},"posInfo":{"x":378,"y":42},"state":0,"viewType":"Output"},"resource":{"html":"<table>\n     <tr>\n        <td>\n            <input type=\"button\" value=\">>\" id=\"edit_deselectButton\">\n        </td>\n        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\n        <td>\n            <input type=\"button\" value=\"<<\" id=\"edit_selectButton\">\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <h2>Selected</h2>\n        </td>\n        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\n        <td>\n            <h2>Available</h2>\n        </td>\n    </tr>\n    <tr>\n        <td class=\"model_listCell\">\n            <div id=\"edit_selectedCell\" class=\"model_displayDiv\"></div>\n        </td>\n        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\n        <td class=\"model_listCell\">\n            <div id=\"edit_availableCell\" class=\"model_displayDiv\"></div>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <input type=\"button\" value=\"Commit\" id=\"edit_commitButton\">\n        </td>\n        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\n        <td>\n            <input type=\"button\" value=\"Reset\" id=\"edit_resetButton\">\n        </td>\n    </tr>\n</table>\n","css":".model_listCell {\n    vertical-align: top;\n    border: 1px solid black;\n}\n.model_displayDiv {\n    height: 500px;\n    overflow: auto;   \n}","setData":"if(!data) return;\nif(!this.selectedCell) return;\nif(!this.availableCell) return;\n\nif( (data.selected === undefined) ||\n    (data.available === undefined) ||\n    (data.metaFileId === undefined) ||\n    (data.existing === undefined)) {\n    return;\n}\n\nif(this.activeMetaFileId != data.metaFileId) {\n    //refresh the selection and exit\n    //this will trigger another update\n    this.updateSavedSelectedEntries(data.existing,data.available);\n    this.activeMetaFileId = data.metaFileId;\n    return;\n}\n\nthis.selectedEntries = data.selected;\nthis.availableEntries = data.available;\nthis.existingEntries = data.existing;\n\nthis.loadSelectedEntries();\nthis.loadAvailableEntries();\n\n\n","constructorAddition":"this.selectedEntries = null;\nthis.availableEntries = null;\nthis.initialEntries = null;\n\nthis.selectedElements = null;\nthis.availableElements = null;\n\nthis.selectedCell = null;\nthis.availableCell = null;\n\nthis.activeMetaFileId = null;\n\nthis.onSelectClicked = function() {\n    var newSelectedEntries = this.addCheckedAndGetNewSelected(this.availableElements);\n    this.setNewSelectedEntries(newSelectedEntries);\n}\n\nthis.onDeselectClicked = function() {\n    var newSelectedEntries = this.removeCheckedAndGetNewSelected(this.selectedElements);\n    this.setNewSelectedEntries(newSelectedEntries);\n}\n\nthis.onCommitClicked = function() {\n    \n    var taskResult = {};\n    taskResult.state = \"SUCCESS\";\n    taskResult.data = {};\n    taskResult.data.selectedFileEntries = this.selectedEntries;\n    \n    //copy the data to the target recipe entries\n    var messenger = mode.getMessenger();\n    messenger.dataUpdate(\"taskResults.editMetaFile\",taskResult);\n}\n\nthis.onResetClicked = function() {\n    this.updateSavedSelectedEntries(this.existingEntries,this.availableEntries);\n}\n\n//=====================================\n// Initialize Data Methods\n//=====================================\n\nthis.updateSavedSelectedEntries = function(initialRecipeEntries,availableFileEntries) {\n    var newSelectedEntries = this.createSelectedArrayFromExisting(initialRecipeEntries,availableFileEntries);\n    var messenger = mode.getMessenger();\n    messenger.dataUpdate(\"selectedFileEntries\",newSelectedEntries);\n}\n\nthis.createSelectedArrayFromExisting = function(existingEntries,availableEntries) {\n    var newSelectedEntries = {};\n    \n    for(var recipeIdString in existingEntries) {\n        var recipeEntry = existingEntries[recipeIdString];\n        var fileEntryId = recipeEntry.Fields.file_entry_id;\n        if(fileEntryId !== undefined) {\n            var availableEntry = availableEntries[fileEntryId];\n        }\n        else {\n            throw new Error(\"Existing entry ont found in available entries: \" + recipeIdString);\n        }\n        newSelectedEntries[fileEntryId] = availableEntry;\n    }\n    \n    return newSelectedEntries;\n}\n\n//=====================================\n// Load Methods\n//=====================================\n\nthis.loadSelectedEntries = function() {\n    apogeeapp.ui.removeAllChildren(this.selectedCell);\n    this.selectedElements = [];\n    \n    for(var id in this.selectedEntries) {\n        var selectedEntry = this.selectedEntries[id];\n        this.addListElement(id,selectedEntry,this.selectedCell,this.selectedElements);\n    }\n}\n\nthis.loadAvailableEntries = function() {\n    apogeeapp.ui.removeAllChildren(this.availableCell);\n    this.availableElements = [];\n    \n    for(var id in this.availableEntries) {\n        //only includes entries not selected\n        var selectedEntry = this.selectedEntries[id];\n        if(!selectedEntry) {\n            var availableEntry = this.availableEntries[id];\n            this.addListElement(id,availableEntry,this.availableCell,this.availableElements);\n        }\n    }\n}\n\nthis.addListElement = function(id,entry,parentCell,elementsList) {\n    \n    var name = entry.fileTypeEntry.Fields.name + \" - \" + entry.fileEntry.Fields.option_name;\n    \n    var div = document.createElement(\"div\");\n    parentCell.appendChild(div);\n    \n    var checkbox = document.createElement(\"input\");\n    checkbox.setAttribute(\"type\", \"checkbox\");\n    div.appendChild(checkbox);\n    \n    var text = document.createTextNode(name);\n    div.appendChild(text);\n    \n    var element = {};\n    element.id = id;\n    element.div = div;\n    element.checkbox = checkbox;\n    elementsList.push(element);\n    \n}\n\n//=================================\n// Update methods\n//=================================\n\nthis.addCheckedAndGetNewSelected = function(elementList) {\n    var newSelected = apogee.util.deepJsonCopy(this.selectedEntries);\n    for(var i = 0; i < elementList.length; i++) {\n        var element = elementList[i];\n        if(element.checkbox.checked) {\n            var id = element.id;\n            newSelected[id] = this.availableEntries[id];\n        }\n    }\n    return newSelected;\n}\n\nthis.removeCheckedAndGetNewSelected = function(elementList) {\n    var newSelected = apogee.util.deepJsonCopy(this.selectedEntries);\n    for(var i = 0; i < elementList.length; i++) {\n        var element = elementList[i];\n        if(element.checkbox.checked) {\n            var id = element.id;\n            delete newSelected[id];\n        }\n    }\n    return newSelected;    \n}\n\nthis.setNewSelectedEntries = function(newSelectedEntries) {\n    var messenger = mode.getMessenger();\n    messenger.dataUpdate(\"selectedFileEntries\",newSelectedEntries);\n}","onLoad":"this.selectedCell = document.getElementById(\"edit_selectedCell\");\nthis.availableCell = document.getElementById(\"edit_availableCell\");\n\nthis.selectButton = document.getElementById(\"edit_selectButton\");\nthis.deselectButton = document.getElementById(\"edit_deselectButton\");\n\nthis.commitButton = document.getElementById(\"edit_commitButton\");\nthis.resetButton = document.getElementById(\"edit_resetButton\");\n\nvar instance = this;\n\nthis.selectButton.onclick = function() {\n    instance.onSelectClicked();\n}\nthis.deselectButton.onclick = function() {\n    instance.onDeselectClicked();\n}\nthis.commitButton.onclick = function() {\n    instance.onCommitClicked();\n}\nthis.resetButton.onclick = function() {\n    instance.onResetClicked();\n}\n\nthis.initialized = true;"}},"selectedFileEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":452,"height":754},"posInfo":{"x":32,"y":291},"state":-1,"viewType":"JSON"}},"initialFileEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":625,"height":300},"posInfo":{"x":34,"y":19},"state":-1,"viewType":"Formula"}},"initialRecipeEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":541,"height":377},"posInfo":{"x":32,"y":107},"state":-1,"viewType":"Formula"}},"selectedMetaFileEntry":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":645,"height":404},"posInfo":{"x":33,"y":63},"state":-1,"viewType":"Formula"}}}},"submit":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":75,"y":75}},"children":{"submitControl":{"type":"apogeeapp.app.CustomControlComponent","windowState":{"sizeInfo":{"width":483,"height":280},"posInfo":{"x":14,"y":294},"state":0,"viewType":"Output"},"resource":{"html":"<textarea id=\"submit_messageInput\"></textarea><br>\n<input type=\"button\" id=\"submit_commitButton\" value=\"Commit\"></input>\n<input type=\"button\" id=\"submit_cancelButton\" value=\"Cancel\"></input>","onLoad":"this.submitButton = document.getElementById(\"submit_commitButton\");\nthis.cancelButton = document.getElementById(\"submit_cancelButton\");\nthis.messageInput = document.getElementById(\"submit_messageInput\");\nthis.initialized = true;\n\nvar instance = this;\nthis.submitButton.onclick = function() {\n    instance.onSubmit();\n}\nthis.cancelButton.onclick = function() {\n    instance.onCancel();\n}","constructorAddition":"this.messageInput = null;\nthis.submitButton = null;\nthis.cancelButton = null;\nthis.initialized = false;\n\nthis.onSubmit = function() {\n    \n    if(!this.initialized) {\n        return;\n    }\n    \n    var commitMessage = this.messageInput.value.trim();\n    if((!commitMessage)||(commitMessage.length === 0)) {\n        alert(\"You must enter a commit message!\");\n        return;\n    }\n    this.messageInput.value = \"\";\n    \n    if((!this.instructionList)||(this.instructionList.length === 0)) {\n        alert(\"There is no data to commit.\");\n        return;\n    }\n    \n    var updateInfo = [];\n    var updateEntry;\n    \n    updateEntry = {};\n    updateEntry.memberName = \"commitMessage\";\n    updateEntry.data = commitMessage;\n    updateInfo.push(updateEntry);\n    \n    updateEntry = {};\n    updateEntry.memberName = \"liveInstructionList\";\n    updateEntry.data = this.instructionList;\n    updateInfo.push(updateEntry);\n    \n    var messenger = mode.getMessenger();\n    messenger.compoundDataUpdate(updateInfo,true);\n}\n\nthis.onCancel = function() {\n    \n    if(!this.initialized) {\n        return;\n    }\n\n    alert(\"Not implemented!\");\n    return;\n    \n    // this.messageInput.value = \"\";\n    \n    // var updateInfo = [];\n    // var updateEntry;\n    \n    // updateEntry = {};\n    // updateEntry.memberName = \"commitMessage\";\n    // updateEntry.data = \"\";\n    // updateInfo.push(updateEntry);\n    \n    // updateEntry = {};\n    // updateEntry.memberName = \"liveInstructionList\";\n    // updateEntry.data = null;\n    // updateInfo.push(updateEntry);\n    \n    // var messenger = mode.getMessenger();\n    // messenger.compoundDataUpdate(updateInfo,true);\n}","setData":"this.instructionList = data;","css":"#submit_messageInput {\n    height: 200px;\n    width: 300px;\n}"}},"newRecipeEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":549,"height":332},"posInfo":{"x":513,"y":36},"state":-1,"viewType":"Text"}},"instructionList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":646,"height":486},"posInfo":{"x":491,"y":100},"state":-1,"viewType":"Formula"}},"commitResponse":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":733,"height":438},"posInfo":{"x":524,"y":289},"state":0,"viewType":"Text"}},"combinedEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":797,"height":442},"posInfo":{"x":801,"y":28},"state":-1,"viewType":"Text"}},"commitMessage":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":271,"height":103},"posInfo":{"x":875,"y":152},"state":0,"viewType":"Text"}},"liveInstructionList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":315,"height":124},"posInfo":{"x":490,"y":144},"state":0,"viewType":"Text"}},"taskResult":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":793,"height":621},"posInfo":{"x":34,"y":602},"state":-1,"viewType":"Formula"}},"initialMetaFileEntry":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":238},"posInfo":{"x":28,"y":14},"state":-1,"viewType":"Text"}},"selectedFileEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":596,"height":300},"posInfo":{"x":25,"y":142},"state":-1,"viewType":"Text"}},"initialRecipeEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":631,"height":556},"posInfo":{"x":28,"y":99},"state":-1,"viewType":"Text"}},"selectedMetaFileEntry":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":555,"height":300},"posInfo":{"x":26,"y":55},"state":-1,"viewType":"Text"}},"initialFileEntries":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":552,"height":300},"posInfo":{"x":25,"y":187},"state":-1,"viewType":"Formula"}}}},"loadContext":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":214,"y":67}},"children":{"contextControl":{"type":"apogeeapp.app.CustomControlComponent","windowState":{"sizeInfo":{"width":428,"height":110},"posInfo":{"x":67,"y":55},"state":0,"viewType":"Output"},"resource":{"html":"Context: <input type=\"text\" id=\"context_text\"></input>\n<br><br>\n<input type=\"button\" id=\"context_submit\" value=\"Submit\"></input>","onLoad":"this.textInput = document.getElementById(\"context_text\");\nthis.submitButton = document.getElementById(\"context_submit\");\nthis.initialized = true;\n\nvar instance = this;\nthis.submitButton.onclick = function() {\n    instance.onSubmit();\n}","constructorAddition":"this.textInput = null;\nthis.submitButton = null;\nthis.initialized = false;\n\nthis.onSubmit = function() {\n    if(!this.initialized) return;\n    \n    var context = this.textInput.value.trim();\n    if(context.length === 0) {\n        alert(\"Invalid context value.\");\n        return;\n    }\n    \n    var output = {};\n    output.state = \"SUCCESS\";\n    output.data = {}\n    output.data.context = context;\n    \n    var messenger = mode.getMessenger();\n    messenger.dataUpdate(\"taskResults.loadContext\",output);\n}"}}}}}}}}