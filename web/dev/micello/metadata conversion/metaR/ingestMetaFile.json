{"fileType":"apogee workspace","jsLinks":[],"cssLinks":[],"workspace":{"fileType":"apogee workspace","version":0.2,"data":{"name":"ingestMetaFile","type":"apogee.Folder","children":{"inputProcessing":{"name":"inputProcessing","type":"apogee.Folder","children":{"inputFile":{"name":"inputFile","type":"apogee.JsonTable","updateData":{"data":{"ft":"ThemeMap","v":0,"label":[{"priority":0,"ks":[{"ek":"$image_url","lt":3,"r":"<value>"},{"ek":"$icon","lt":2,"r":"<value>"}]},{"priority":1,"ks":[{"ek":"$label_text","lt":1,"r":"<value>"},{"ek":"short name","lt":1,"r":"<value>"},{"ek":"name","lt":1,"r":"<value>"}]},{"priority":3,"ks":[{"gk":"$image_url","lt":3,"r":"<value>"},{"gk":"$icon","lt":2,"r":"<value>"},{"gk":"$label_text","lt":1,"r":"<value>"},{"gk":"short name","lt":1,"r":"<value>"},{"gk":"name","lt":1,"r":"<value>"},{"gk":"area","v":{"baggage claim":{"lt":2,"r":"Baggage Claim"},"copy/print":{"lt":2,"r":"Copy/Print"},"immigration and customs":{"lt":2,"r":"Immigration and Customs"},"meeting point":{"lt":2,"r":"Meeting Point"},"passport control":{"lt":2,"r":"Passport Control"},"pet relief area":{"lt":2,"r":"Pet Relief Area"},"rest area":{"lt":2,"r":"Rest Area"},"security section":{"lt":2,"r":"Security Section"},"smoke":{"lt":2,"r":"Smoke"}}},{"gk":"equipment","v":{"cash register":{"lt":2,"r":"Cash Register"}},"lt":2,"r":"object"},{"gk":"facility","v":{"bathroom":{"ks":[{"gk":"gender","v":{"female":{"lt":2,"r":"Bathroom W","ks":[{"gk":"disabled access","lt":2,"r":"Bathroom W DA"}]},"male":{"lt":2,"r":"Bathroom M","ks":[{"gk":"disabled access","lt":2,"r":"Bathroom M DA"}]},"family":{"lt":2,"r":"Bathroom Fam","ks":[{"gk":"disabled access","lt":2,"r":"Bathroom Fam DA"}]}}},{"gk":"disabled access","lt":2,"r":"Bathroom DA"}],"lt":2,"r":"Bathroom"},"elevator":{"lt":2,"r":"Elevator"},"elevator bank":{"lt":2,"r":"Elevator"},"escalator":{"lt":2,"r":"Escalator"},"ramp":{"ks":[{"gk":"disabled access","lt":2,"r":"Wheelchair Ramp"}]},"stairs":{"lt":2,"r":"Stairs"},"stairwell":{"lt":2,"r":"Stairs"},"moving walkway":{"lt":2,"r":"Moving Walkway"}}},{"gk":"fixture","v":{"baggage claim":{"lt":2,"r":"Baggage Claim"},"ramp":{"ks":[{"gk":"disabled access","lt":2,"r":"Wheelchair Ramp"}]}}},{"gk":"furnishing","v":{"seat":{"ks":[{"gk":"disabled access","lt":2,"r":"Disabled Access"}]}}},{"gk":"marker","v":{"disabled access":{"lt":2,"r":"Disabled Access"}}},{"gk":"recreation","v":{"playground":{"lt":2,"r":"Playground"}}},{"gk":"safety","v":{"defibrillator":{"lt":2,"r":"Defibrillator"},"emergency exit":{"lt":2,"r":"Emergency Exit"},"eyewash":{"lt":2,"r":"Eyewash"},"fire extinguisher":{"lt":2,"r":"Fire Extinguisher"},"fire pull":{"lt":2,"r":"Fire Pull"},"fire hose":{"lt":2,"r":"Fire Hose"},"first aid":{"lt":2,"r":"First Aid"}},"lt":2,"r":"object"},{"gk":"service","v":{"atm":{"ks":[{"gk":"currency","v":{"general":{"lt":2,"r":"ATM:General"},"dollar":{"lt":2,"r":"ATM"},"yen":{"lt":2,"r":"ATM:Yen"}}}],"lt":2,"r":"ATM"},"bike rack":{"lt":2,"r":"Bike Rack"},"changing station":{"lt":2,"r":"Changing Station"},"flight monitor":{"lt":2,"r":"Flight Monitor"},"luggage cart":{"lt":2,"r":"Luggage Cart"},"locker":{"lt":2,"r":"Locker"},"mail":{"lt":2,"r":"Mail"},"massage chair":{"lt":2,"r":"Massage Chair"},"power":{"lt":2,"r":"Power"},"santa":{"lt":2,"r":"Santa"},"showers":{"lt":2,"r":"Shower"},"stroller":{"lt":2,"r":"Stroller"},"telephone":{"lt":2,"r":"Telephone"},"tv":{"lt":2,"r":"TV"},"valet parking":{"lt":2,"r":"Valet Parking"},"paid parking":{"lt":2,"r":"Paid Parking"},"vending machine":{"lt":2,"r":"Vending Machine"},"wifi":{"lt":2,"r":"Wifi"}},"lt":2,"r":"object"},{"gk":"sign","v":{"stop sign":{"lt":2,"r":"Stop Sign"},"yield sign":{"lt":2,"r":"Yield Sign"}},"lt":2,"r":"object"},{"gk":"signal","v":{"traffic light":{"lt":2,"r":"Traffic Light"}},"lt":2,"r":"object"},{"gk":"traffic","v":{"parking lot":{"ks":[{"gk":"paid","v":{"true":{"lt":2,"r":"Paid Parking"}}}]},"parking spot":{"ks":[{"gk":"disabled access","lt":2,"r":"Disabled Access"}]}}},{"gk":"transit","v":{"bus":{"lt":2,"r":"Bus"},"ground transportation":{"lt":2,"r":"Ground Transportation"},"taxi":{"lt":2,"r":"Taxi"},"train":{"lt":2,"r":"Train"}}},{"gk":"class","v":{"car rental":{"lt":2,"r":"Car Rental"},"cocktails":{"lt":2,"r":"Cocktails"},"coffee":{"lt":2,"r":"Coffee"},"fitness center":{"lt":2,"r":"Fitness Center"},"food and drink":{"lt":2,"r":"Food and Drink"},"gym":{"lt":2,"r":"Gym"},"money changer":{"lt":2,"r":"Money Changer"},"movie theater":{"lt":2,"r":"Movie Theater"},"restaurant":{"lt":2,"r":"Restaurant"},"shoe shine":{"lt":2,"r":"Shoe Shine"},"ticketing, check-in":{"lt":2,"r":"Ticketing, Check-in"},"transit hotel":{"lt":2,"r":"Transit Hotel"}}},{"gk":"use","v":{"lost and found":{"lt":2,"r":"Lost and Found"},"meditation room":{"lt":2,"r":"Meditation Room"},"cafeteria":{"lt":2,"r":"Cafeteria"},"information":{"lt":2,"r":"Information"},"customer service":{"lt":2,"r":"Customer Service"},"medical":{"lt":2,"r":"Medical"},"police/security":{"lt":2,"r":"Police/Security"}}},{"gk":"changing station","lt":2,"r":"Changing Station"}]}],"style":[{"priority":1,"ks":[{"ek":"$style","n":"<value>"}]},{"priority":3,"ks":[{"gk":"$style","n":"<value>"},{"gk":"surface","v":{"grass":{"n":"Grass"},"sand":{"n":"Earth"},"ice":{"n":"Ice"}}},{"gk":"area","v":{"aisle":{"n":"Aisle"},"baggage claim":{"n":"Section"},"parcel":{"n":"Parcel"},"section":{"n":"Section"}},"n":"Area"},{"gk":"barrier","v":{"fence":{"n":"Obstruction"},"gate":{"n":"Gate"},"obstruction":{"n":"Obstruction"},"railing":{"n":"Obstruction"}},"n":"Obstruction"},{"gk":"facility","v":{"bathroom":{"n":"Room"},"column":{"n":"Wall"},"door":{"n":"Door"},"doorway":{"n":"Hallway"},"opening":{"n":"Opening"},"elevator":{"n":"Level Change"},"elevator bank":{"n":"Level Change"},"escalator":{"n":"Level Change"},"hallway":{"n":"Hallway"},"hallway intersection":{"n":"Hallway"},"hall area":{"n":"Hallway"},"inaccessible space":{"n":"Inaccessible Space"},"floor opening":{"n":"Open Obstruction"},"landing":{"n":"Landing"},"moving walkway":{"n":"Moving Walkway"},"patio":{"n":"Patio"},"porch":{"n":"Porch"},"platform":{"n":"Platform"},"ramp":{"n":"Ramp"},"room":{"n":"Room"},"stairs":{"n":"Level Change"},"stairway":{"n":"Level Change"},"stairwell":{"n":"Level Change"},"step":{"n":"Step"},"stage":{"n":"Stage","deprecated":true},"unit":{"ks":[{"gk":"class","v":{"money changer":{"n":"Service"},"shoe shine":{"n":"Service"}}},{"gk":"use","v":{"medical":{"n":"Service"},"police/security":{"n":"Service"}}}],"n":"Unit"},"wall":{"n":"Wall"},"window":{"n":"Window"},"window opening":{"n":"Wall"},"element":{"n":"Object"},"area":{"n":"Area"},"detail":{"n":"Object"}}},{"gk":"fixture","v":{"baggage carousel":{"n":"Baggage Claim"},"bin":{"n":"Bin"},"booth":{"n":"Booth"},"checkout":{"n":"Checkout"},"countertop":{"n":"Countertop"},"cubicle":{"n":"Cubicle"},"kiosk":{"n":"Kiosk"},"partition":{"n":"Partition"},"ramp":{"n":"Ramp"},"shelf":{"n":"Shelf"},"stage":{"n":"Stage"},"stall":{"n":"Stall"}},"n":"Object"},{"gk":"furnishing","v":{"chair":{"n":"Chair"},"table":{"n":"Table"},"desk":{"n":"Desk"},"shelf":{"n":"Shelf"},"bin":{"n":"Bin"}},"n":"Object"},{"gk":"equipment","n":"Object"},{"gk":"marker","v":{"entrance":{"n":"Entrance"},"large text":{"n":"Large Text"},"true":{"n":"Marker"},"small text":{"n":"Small Text"},"traffic marker":{"n":"Traffic Marker"},"disabled access":{"n":"Service"},"parking":{"n":"Parking"}}},{"gk":"meta","v":{"coordinates":{"n":"Meta-Coordinates"},"source":{"n":"Meta-Source"},"guide":{"n":"Meta-Guide"},"level outline":{"n":"Meta-Level-Outline"},"ground intersect":{"n":"Meta-Ground-Intersect"}}},{"gk":"object","v":{"invalid":{"n":"INVALID"},"unknown":{"n":"Unknown"}},"n":"Object"},{"gk":"recreation","v":{"athletic field":{"n":"Area"},"playground":{"n":"Area"}},"n":"Area"},{"gk":"safety","v":{"defibrillator":{"n":"Service"}},"n":"Object"},{"gk":"service","v":{"flight monitor":{"n":"Object"},"changing station":{"n":"Object"}},"n":"Service"},{"gk":"sign","n":"Object"},{"gk":"signal","n":"Object"},{"gk":"structure","v":{"building":{"n":"Building"},"parking structure":{"n":"Parking Structure"},"subbuilding":{"n":"Subbuilding"},"tent":{"n":"Tent"}},"n":"Building"},{"gk":"traffic","v":{"crosswalk":{"n":"Area"},"parking lot":{"n":"Parking Lot"},"parking spot":{"n":"Parking Spot"},"railway":{"n":"Railway"},"railway tie":{"n":"Railway"},"railway rail":{"n":"Railway"},"road":{"n":"Road"},"road intersection":{"n":"Road"},"walkway":{"ks":[{"gk":"covered","v":{"true":{"n":"Covered Walkway"}}}],"n":"Walkway"},"walkway intersection":{"ks":[{"gk":"covered","v":{"true":{"n":"Covered Walkway"}}}],"n":"Walkway"}}},{"gk":"transit","v":{"railway":{"deprecated":true,"n":"Railway"},"railway tie":{"deprecated":true,"n":"Railway"},"railway rail":{"deprecated":true,"n":"Railway"}},"n":"Service"},{"gk":"vegetation","v":{"grass":{"n":"Grass"},"greenery":{"n":"Greenery"},"garden":{"n":"Garden"},"tree":{"n":"Tree"},"earth":{"n":"Earth"}}},{"gk":"vehicle","v":{"airplane":{"n":"Airplane"}}},{"gk":"water","n":"Water"}],"n":"Object"}]},"description":""}},"entryList":{"name":"entryList","type":"apogee.JsonTable","updateData":{"data":["section","entry_parent","entry_type","entry_value","entry_data"],"description":""}},"preliminaryEntryFormat":{"name":"preliminaryEntryFormat","type":"apogee.JsonTable","updateData":{"data":["parentPath","type","value","entry_data"],"description":""}},"preliminaryEntryList":{"name":"preliminaryEntryList","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"return readPreliminaryEntries[fileType](inputFile);","supplementalCode":"","description":""}},"fileType":{"name":"fileType","type":"apogee.JsonTable","updateData":{"data":"themeMap","description":""}},"readPreliminaryEntries":{"name":"readPreliminaryEntries","type":"apogee.Folder","children":{"theme":{"name":"theme","type":"apogee.FunctionTable","updateData":{"argList":["metaFile"],"functionBody":"var output = [];\n\nvar fileName = metaFile.nm;\nvar iurl = metaFile.iurl;\n\nfor(var sectionTag in themeSectionMap) {\n    var section = metaFile[sectionTag];\n    var sectionValue = themeSectionMap[sectionTag];\n    if(section) {\n        for(var key in section) {\n            var data = section[key];\n            \n            if((iurl)&&(sectionTag == \"i\")) {\n                data = getIconData(data,iurl);\n            }\n            \n            var entry = {};\n            entry.section = sectionValue;\n            entry.entry_value = key;\n            entry.entry_data = data;\n            entry.option_name = fileName;\n            output.push(entry);\n        }\n    }\n}\n\nreturn output;","supplementalCode":"function getIconData(data,iurl) {\n    var outData = apogee.util.deepJsonCopy(data);\n    if(data.rurl) {\n        outData.url = iurl + data.rurl;\n        delete outData.rurl;\n    }\n    return outData;\n}","description":""}},"themeSectionMap":{"name":"themeSectionMap","type":"apogee.JsonTable","updateData":{"data":{"s":["style"],"m":["marker"],"i":["icon"],"l":["labelStyle"]},"description":""}},"presetOverides":{"name":"presetOverides","type":"apogee.FunctionTable","updateData":{"argList":["metaFile"],"functionBody":"var sectionEntries = getSectionEntries(metaFile);","supplementalCode":"","description":""}},"themeMap":{"name":"themeMap","type":"apogee.FunctionTable","updateData":{"argList":["metaFile"],"functionBody":"var output = [];\n\nvar fileName = \"Standard\";\n\nvar labelSectionValue = [\"label\"];\nvar labelSection = metaFile.label;\nvar labelPayloadKeys = [\"lt\",\"r\",\"trans\"];\naddEntries(fileName,labelSectionValue,labelSection,labelPayloadKeys,output);\n\nvar styleSectionValue = [\"style\"];\nvar styleSection = metaFile.style;\nvar stylePayloadKeys = [\"n\"];\naddEntries(fileName,styleSectionValue,styleSection,stylePayloadKeys,output);\n\nreturn output;","supplementalCode":"function addEntries(fileName,sectionValue,section,payloadTags,output) {\n    \n    var prioritySection;\n    var priority;\n    var fixedData;\n    \n    for(var i = 0; i < section.length; i++) {\n        prioritySection = section[i];\n        priority = prioritySection.priority;\n        \n        fixedData = {};\n        fixedData.payloadTags = payloadTags;\n        fixedData.fileName = fileName;\n        fixedData.sectionValue = sectionValue;\n        fixedData.insertionInfo = {\"priority\":priority};\n        \n        parentPath = [];\n        var keyList = prioritySection.ks;\n        if(keyList) {\n            addEntriesFromKeyList(keyList,parentPath,fixedData,output);\n        }\n    }\n    \n    //on the last priority section, check for a default\n    var data = {};\n    var hasData = false;\n    for(var it = 0; it < fixedData.payloadTags.length; it++) {\n        var tag = fixedData.payloadTags[it];\n        if(prioritySection[tag] !== undefined) {\n            data[tag] = prioritySection[tag];\n            hasData = true;\n        }\n    }\n    \n    if(hasData) {\n        addDefaultEntry(data,fixedData,output);\n    }\n    \n}\n\nfunction addEntriesFromKeyList(keyList,parentPath,fixedData,output) {\n    for(var i = 0; i < keyList.length; i++) {\n        var inEntry = keyList[i];\n        addKeyEntry(inEntry,parentPath,fixedData,output);\n    }\n}\n\nfunction addKeyEntry(inEntry,parentPath,fixedData,output) {\n    \n    //get the key type\n    var key;\n    var keyType;\n    if(inEntry.gk !== undefined) {\n        keyType = \"gk\";\n        key = inEntry.gk;\n    } \n    else if(inEntry.ek !== undefined) {\n        keyType = \"ek\";\n        key = inEntry.ek;\n    } \n    else if(inEntry.ak !== undefined) {\n        keyType = \"ak\";\n        key = inEntry.ak;\n    } \n    \n    \n    //update parent path for this key type  (we are assuming a path will use a single key type!)\n    if(parentPath.length === 0) {\n        parentPath.push(keyType);\n    }\n    else {\n        if(parentPath.lenth > 0) {\n            if(parentPath[0] != keyType) {\n                //I don't think we need to support this...\n                throw new Error(\"Theme map entry with different key types! Legal but not yet supported here.\")\n            }\n        }\n    }\n    \n    //update the path for the children\n    var thisPath = apogee.util.deepJsonCopy(parentPath);\n    thisPath.push(key);\n    \n    var data = {};\n    var hasData = false;\n    for(var it = 0; it < fixedData.payloadTags.length; it++) {\n        var tag = fixedData.payloadTags[it];\n        if(inEntry[tag] !== undefined) {\n            data[tag] = inEntry[tag];\n            hasData = true;\n        }\n    }\n    \n    //only save this entry if there is actually data\n    if(hasData) {\n        var outEntry = {};\n        outEntry.insertionInfo = fixedData.insertionInfo;\n        outEntry.section = fixedData.sectionValue;\n        outEntry.option_name = fixedData.fileName;\n        outEntry.parent_path = parentPath;\n        outEntry.entry_type = \"key\";\n        outEntry.entry_value = key;\n        outEntry.entry_data = data;\n        output.push(outEntry);\n    }\n    \n    //do the children!\n    var valueMap = inEntry.v;\n    if(valueMap) {\n        addEntriesFromValueMap(valueMap,thisPath,fixedData,output);\n    }\n}\n\nfunction addEntriesFromValueMap(valueMap,parentPath,fixedData,output) {\n for(var value in valueMap) {\n        var inEntry = valueMap[value];\n        addValueEntry(value,inEntry,parentPath,fixedData,output);\n    }\n}\n\nfunction addValueEntry(value,inEntry,parentPath,fixedData,output) {\n\n    //update the path for the children\n    var thisPath = apogee.util.deepJsonCopy(parentPath);\n    thisPath.push(value);\n    \n    var data = {};\n    var hasData = false;\n    for(var it = 0; it < fixedData.payloadTags.length; it++) {\n        var tag = fixedData.payloadTags[it];\n        if(inEntry[tag] !== undefined) {\n            data[tag] = inEntry[tag];\n            hasData = true;\n        }\n    }\n    \n    //only save this entry if there is actually data\n    if(hasData) {\n        var outEntry = {};\n        outEntry.insertionInfo = fixedData.insertionInfo;\n        outEntry.section = fixedData.sectionValue;\n        outEntry.option_name = fixedData.fileName;\n        outEntry.parent_path = parentPath;\n        outEntry.entry_type = \"value\";\n        outEntry.entry_value = value;\n        outEntry.entry_data = data;\n        output.push(outEntry);\n    }\n    \n    //do the children!\n    var keyList = inEntry.ks;\n    if(keyList) {\n        addEntriesFromValueMap(keyList,thisPath,fixedData,output);\n    }\n}\n\n\nfunction addDefaultEntry(data,fixedData,output) {\n    var outEntry = {};\n    outEntry.insertionInfo = fixedData.insertionInfo;\n    outEntry.section = fixedData.sectionValue;\n    outEntry.option_name = fixedData.fileName;\n    outEntry.entry_type = \"default\";\n    outEntry.entry_value = \"default\";\n    outEntry.entry_data = data;\n    output.push(outEntry);\n}","description":""}}}}}}}}},"components":{"inputProcessing":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":75,"y":75}},"children":{"inputFile":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":420,"height":660},"posInfo":{"x":42,"y":87},"state":0,"viewType":"JSON"}},"entryList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":759,"y":19},"state":0,"viewType":"Form"}},"preliminaryEntryFormat":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":101,"y":403},"state":0,"viewType":"Form"}},"preliminaryEntryList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":932,"height":527},"posInfo":{"x":94,"y":260},"state":0,"viewType":"Text"}},"fileType":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":328,"height":66},"posInfo":{"x":42,"y":16},"state":0,"viewType":"Text"}},"readPreliminaryEntries":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":818,"y":171}},"children":{"theme":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":552,"height":470},"posInfo":{"x":28,"y":130},"state":0,"viewType":"Code"}},"themeSectionMap":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":479},"posInfo":{"x":705,"y":46},"state":-1,"viewType":"Form"}},"presetOverides":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":400,"height":400},"posInfo":{"x":402,"y":184},"state":0,"viewType":"Code"}},"themeMap":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":832,"height":821},"posInfo":{"x":511,"y":30},"state":0,"viewType":"Private"}}}}}}}}