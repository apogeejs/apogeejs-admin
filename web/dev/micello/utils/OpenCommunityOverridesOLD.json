{"fileType":"apogee app js workspace","version":"0.40","references":[],"workspace":{"fileType":"apogee workspace","version":0.2,"name":"OpenCommunityOverrides","data":{"name":"Model","type":"apogee.Folder","children":{"overridesTemplate":{"name":"overridesTemplate","type":"apogee.JsonTable","updateData":{"data":"https://mfs-hub-master.micello.com/ms/v1/mfile/map/{0}/overrides","description":""}},"overridesFile":{"name":"overridesFile","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if((!cidInput.data)||(cidInput.data.cid === undefined)) return apogeeutil.INVALID_VALUE;\n\nvar cid = parseInt(cidInput.data.cid);\n\nvar baseUrl = apogeeutil.formatString(overridesTemplate,cid);\nvar completedUrl = login.appendQueryParams(baseUrl);\n\nreturn .jsonRequest(completedUrl);","supplementalCode":"","description":""}},"login":{"name":"login","type":"apogee.Folder","children":{"loginUrl":{"name":"loginUrl","type":"apogee.JsonTable","updateData":{"data":"https://factory.micello.com/TestAuthorization/loginjson","description":""}},"sessionResponse":{"name":"sessionResponse","type":"apogee.JsonTable","updateData":{"data":{"responseCode":1,"paramTable":[{"urlPattern":"http://mfs-hub-master.micello.com","params":[["key","pvLuRozg2EZVrpE8nCpCrQT0FOHcLh"]]},{"urlPattern":"http://mfs-us-1.micello.com","params":[["key","nS71TmmSmgvwcXlfrGrin38AMLP48B"]]},{"urlPattern":"http://mfs.micello.com","params":[["key","nS71TmmSmgvwcXlfrGrin38AMLP48B"]]},{"urlPattern":"http://factory-mfs-1.micello.com","params":[["key","yfZkszbELEy6lxz1sSeUZscJlC41hL"]]},{"urlPattern":"http://factory-mfs.micello.com","params":[["key","yfZkszbELEy6lxz1sSeUZscJlC41hL"]]},{"urlPattern":"http://preview.micello.com","params":[["key","uNzHkTmxGAbMWq9EoJnQmXZTF6lRVL"]]},{"urlPattern":"http://test1.micello.com","params":[["key","MesQ5W9DFZfotzQXlKUSOxMaai9FLR"]]},{"urlPattern":"http://mfs-sg-1.micello.com","params":[["key","5lfPO4vSsb5XjJfQSPTlT2h2sKi9Ir"]]}],"sessionKey":"SESS54347d4d53880b9a14e75afb5bec0e6a=d42a2kvvlrsil7gc5h2baikev1"},"description":""}},"savedUserName":{"name":"savedUserName","type":"apogee.JsonTable","updateData":{"data":"","description":""}},"loginControl":{"name":"loginControl","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var onSubmit = (formData) => {\n    \n    //on click\n    var bodyJson = {};\n    bodyJson.userName = formData.userName;\n    bodyJson.password = formData.password;\n    \n    var options = {};\n    options.body = JSON.stringify(bodyJson);\n    options.method = \"POST\";\n    \n    var requestPromise = .jsonRequest(loginUrl,options);\n    \n    //set the response\n    apogeeMessenger.asynchDataUpdate(\"sessionResponse\",requestPromise);\n    \n    //this clears the password...\n    apogeeMessenger.dataUpdate(\"savedUserName\",formData.userName);\n}\n\nvar layout = [];\n\n//title\nentry = {};\nentry.type = \"heading\";\nentry.level = 2;\nentry.text = \"Login\";\nlayout.push(entry);\n\n//text entry\nentry = {};\nentry.type = \"textField\";\nentry.label = \"User Name: \";\nentry.key = \"userName\";\nentry.value = savedUserName;\nlayout.push(entry);\n\n//text entry\nentry = {};\nentry.type = \"textField\";\nentry.label = \"Password: \";\nentry.password = true;\nentry.key = \"password\";\nlayout.push(entry);\n\n//suvbmit (no cancel)\nentry = {};\nentry.type = \"submit\";\nentry.onSubmit = onSubmit;\nlayout.push(entry);\n\nreturn layout;\n","supplementalCode":"","description":""}},"sessionKey":{"name":"sessionKey","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(sessionResponse.sessionKey) {\n    return sessionResponse.sessionKey;\n}\nelse if(sessionResponse.responseCode < 0) {\n    throw new Error(\"Error in login: \" + sessionResponse.message);\n}\nelse {\n    return \"LOGIN NEEDED!\";\n}","supplementalCode":"","description":""}},"appendQueryParams":{"name":"appendQueryParams","type":"apogee.FunctionTable","updateData":{"argList":["inUrl"],"functionBody":"if((!sessionResponse)||(!sessionResponse.paramTable)) {\n    throw new Error(\"Param table not loaded!\");\n}\n\n//we need to accomadate both http and https patterns\nvar httpsUrl;\nvar httpUrl;\nif(inUrl.startsWith(\"https:\")) {\n    httpsUrl = inUrl;\n    httpUrl = \"http\" + inUrl.substring(5);\n}\nelse if(inUrl.startsWith(\"http:\")) {\n    httpsUrl = \"https\" + inUrl.substring(4);\n    httpUrl = inUrl;\n}\nelse throw new Error(\"Unknown protocol! Use http or https.\");\n\nvar isMatchingKey = (paramEntry) => {\n    if(paramEntry.urlPattern.startsWith(\"http:\")) return httpUrl.startsWith(paramEntry.urlPattern);\n    else if(paramEntry.urlPattern.startsWith(\"https:\")) return httpsUrl.startsWith(paramEntry.urlPattern);\n    else throw new Error(\"Unknown reference URL protocol: \" + paramEntry.urlPattern);\n}\nvar paramEntry = sessionResponse.paramTable.find(isMatchingKey);\n\nif(paramEntry) {\n    if(paramEntry.params.length > 1) {\n        throw new Error(\"Code only supports 1 appended parameter. (Is an easy fix to add more)\")\n    }\n    else if(paramEntry.params.length === 1) {\n        return httpsUrl + \"?\" + paramEntry.params[0][0] + \"=\" + paramEntry.params[0][1];\n    }\n}\n      \n//no params to add\nreturn httpsUrl;\n","supplementalCode":"","description":""}},"loginResult":{"name":"loginResult","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var msg;\n\nif(!sessionResponse) {\n    msg = \"Login Needed!\";\n    style = \"color:red\";\n}\nelse if(sessionResponse.responseCode == 1) {\n    msg = \"Login Success\";\n    style = \"color:blue\";\n}\nelse {\n    msg = \"Login Failure: \" + sessionResponse.message;\n    style = \"color:red\";\n}\n\nvar textEntry = {};\ntextEntry.type = \"htmlDisplay\";\ntextEntry.html = \"<span style='\" + style + \"' + >\" + msg + \"</span>\";\n\nreturn [textEntry];\n","supplementalCode":"","description":""}}}},"overrideFileUrls":{"name":"overrideFileUrls","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"const LIST_KEYS = [\"presetOverrides\",\"themeMapOverrides\",\"stringsOverrides\",\"inputColorOverrides\"];\nconst MAP_KEYS = [\"themeOverrides\"];\n\nvar urlList = [];\n\nLIST_KEYS.forEach( tag => {\n    var itemList = overridesFile[tag];\n    if(itemList) {\n        itemList.forEach( url => {\n            if(urlList.indexOf(url) < 0) {\n                urlList.push(url);\n            }\n        });\n    }\n});\n\n\nMAP_KEYS.forEach( tag => {\n    var itemMap = overridesFile[tag];\n    if(itemMap) {\n        for(var key in itemMap) {\n            var itemList = itemMap[key];\n            if(itemList) {\n                itemList.forEach( url => {\n                    if(urlList.indexOf(url) < 0) {\n                        urlList.push(url);\n                    }\n                });\n            }\n        }\n    }\n});\n\nreturn urlList;","supplementalCode":"","description":""}},"overrideFiles":{"name":"overrideFiles","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var promiseList = overrideFileUrls.map(url => .jsonRequest(login.appendQueryParams(url)));\n\nreturn Promise.all(promiseList);","supplementalCode":"","description":""}},"file":{"name":"file","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"if(fileIndex < 0) {\n    return \"\";\n}\n\nif(overrideFileUrls.length <= fileIndex) {\n    //this shouldn't happen\n    throw new Error(\"Invalid file selection\");\n}\n\nreturn overrideFiles[fileIndex];","supplementalCode":"","description":""}},"cidInput":{"name":"cidInput","type":"apogee.Folder","children":{"layout":{"name":"layout","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var layout = []\n\nvar entry = {};\nentry.type = \"textField\";\nentry.label = \"CID: \";\nentry.key = \"cid\";\nlayout.push(entry);\n\nreturn layout;","supplementalCode":"","description":""}},"data":{"name":"data","type":"apogee.JsonTable","updateData":{"data":{"cid":"78"},"description":""}},"isInputValid":{"name":"isInputValid","type":"apogee.FunctionTable","updateData":{"argList":["formValue"],"functionBody":"//If data valid, return true. If data is invalid, return an error message.\nif(formValue.length === 0) return \"You must enter a CID!\";\n\nvar cid = parseInt(formValue.cid);\nif(isNaN(cid)) return \"Invalid CID!\";\n\nreturn true;","supplementalCode":"","description":""}}},"childrenNotWriteable":true},"fileSelection":{"name":"fileSelection","type":"apogee.Folder","children":{"layout":{"name":"layout","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var layout = [];\n\n//files\nvar dummyValue = \" \";\nvar fileList = [dummyValue].concat(overrideFileUrls);\n\nvar entry = {};\nentry.type = \"dropdown\";\nentry.label = \"Overide File: \";\nentry.key = \"url\";\nentry.entries = fileList;\nentry.value = dummyValue;\nlayout.push(entry);\n\n\nreturn layout;","supplementalCode":"","description":""}},"data":{"name":"data","type":"apogee.JsonTable","updateData":{"data":{"url":"http://eng.micello.com/mfs/ms/v1/mfile/map/78/overrides/thememap"},"description":""}},"isInputValid":{"name":"isInputValid","type":"apogee.FunctionTable","updateData":{"argList":["formValue"],"functionBody":"//If data valid, return true. If data is invalid, return an error message.\nreturn true;","supplementalCode":"","description":""}}},"childrenNotWriteable":true},"fileIndex":{"name":"fileIndex","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var selectedUrl = fileSelection.data.url;\n\nif(!selectedUrl) return apogeeutil.INVALID_VALUE;\n\nvar index = overrideFileUrls.indexOf(selectedUrl);\n\nreturn index;","supplementalCode":"","description":""}}}}},"components":{"type":"apogeeapp.app.FolderComponent","tabOpen":true,"treeState":1,"children":{"overridesTemplate":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":528,"height":31},"posInfo":{"x":38,"y":28},"state":0,"viewType":"Data"},"dataView":"Text Data"},"overridesFile":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":602,"height":442},"posInfo":{"x":31,"y":325},"state":0,"viewType":"Data"},"dataView":"Colorized"},"login":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":927,"y":68}},"tabOpen":true,"treeState":1,"children":{"loginUrl":{"type":"apogeeapp.app.TextComponent","windowState":{"sizeInfo":{"width":465,"height":43},"posInfo":{"x":34,"y":18},"state":-1,"viewType":"Text"}},"sessionResponse":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":697,"height":330},"posInfo":{"x":17,"y":355},"state":0,"viewType":"Data"},"dataView":"Colorized"},"savedUserName":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":284,"height":69},"posInfo":{"x":23,"y":68},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"loginControl":{"type":"apogeeapp.app.DynamicForm","windowState":{"sizeInfo":{"width":357,"height":217},"posInfo":{"x":280,"y":33},"state":0,"viewType":"Output"}},"sessionKey":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":555,"height":68},"posInfo":{"x":768,"y":411},"state":0,"viewType":"Data"},"dataView":"Colorized"},"appendQueryParams":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":845,"height":505},"posInfo":{"x":767,"y":356},"state":-1,"viewType":"Code"}},"loginResult":{"type":"apogeeapp.app.DynamicForm","windowState":{"sizeInfo":{"width":228,"height":47},"posInfo":{"x":767,"y":591},"state":0,"viewType":"Output"}}}},"overrideFileUrls":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":874,"height":203},"posInfo":{"x":666,"y":66},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"overrideFiles":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":923,"height":300},"posInfo":{"x":667,"y":105},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"file":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":725,"height":486},"posInfo":{"x":672,"y":334},"state":0,"viewType":"Data"},"dataView":"Colorized"},"cidInput":{"type":"apogeeapp.app.FormDataComponent","windowState":{"sizeInfo":{"width":405,"height":75},"posInfo":{"x":37,"y":192},"state":0,"viewType":"Form"}},"fileSelection":{"type":"apogeeapp.app.FormDataComponent","windowState":{"sizeInfo":{"width":641,"height":78},"posInfo":{"x":661,"y":150},"state":0,"viewType":"Form"}},"fileIndex":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":670,"y":286},"state":-1,"viewType":"Formula"},"dataView":"Colorized"}}},"activeTabMember":"Model.login"}