{"fileType":"apogee app js workspace","version":"0.40","references":[],"workspace":{"fileType":"apogee workspace","version":0.2,"name":"CustomerAnalyze","data":{"name":"Model","type":"apogee.Folder","children":{"grantByCustomer":{"name":"grantByCustomer","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = {};\n\nvar entry;\n\nentry = customerGrants[0];\nif(entry[ACCOUNT_INDEX] !== \"Account\") {\n    throw new Error(\"Header row missing!\");\n}\nif(entry[PRODUCT_INDEX] !== \"Product Type\") {\n    throw new Error(\"Header row missing!\");\n}\nif(entry[CID_INDEX] !== \"Community ID\") {\n    throw new Error(\"Header row missing!\");\n}\n\nfor(var i = 1; i < customerGrants.length; i++) {\n    var entry = customerGrants[i];\n    var customer = entry[0];\n    \n    if(isExcluded(customer)) {\n        continue;\n    }\n    \n    var customerEntry = value[customer];\n    if(!customerEntry) {\n        customerEntry = [];\n        value[customer] = customerEntry;\n    }\n    customerEntry.push(entry);\n}\nreturn value;\n\n","supplementalCode":"function isExcluded(customer) {\n    return (exclusionAccounts.indexOf(customer) >= 0);\n}","description":""}},"exclusionAccounts":{"name":"exclusionAccounts","type":"apogee.JsonTable","updateData":{"data":["Micello Inc Primary","Micello Customer"],"description":""}},"customerAccounts":{"name":"customerAccounts","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = [];\nfor(var key in grantByCustomer) {\n    value.push(key);\n}\nreturn value;\n\n","supplementalCode":"","description":""}},"activeCommunities":{"name":"activeCommunities","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvar cidList = [];\n\nvar cidMap = {};\nfor(var customerKey in grantByCustomer) {\n    var grantList = grantByCustomer[customerKey];\n    for(var i = 0; i < grantList.length; i++) {\n        var grantEntry = grantList[i];\n        var cid = grantEntry[CID_INDEX];\n        cidMap[cid] = true;\n    }\n}\n\n//add cids to array\nfor(var cidKey in cidMap) {\n    cidList.push(Number(cidKey));\n}\n\n//sort low to high\nvar numericSortFunction = function(a,b) {\n    return a-b;\n}\ncidList.sort(numericSortFunction);\n\nvalue = cidList;\nreturn value;\n\n","supplementalCode":"","description":""}},"CID_INDEX":{"name":"CID_INDEX","type":"apogee.JsonTable","updateData":{"data":5,"description":""}},"PRODUCT_INDEX":{"name":"PRODUCT_INDEX","type":"apogee.JsonTable","updateData":{"data":3,"description":""}},"ACCOUNT_INDEX":{"name":"ACCOUNT_INDEX","type":"apogee.JsonTable","updateData":{"data":0,"description":""}},"customerProducts":{"name":"customerProducts","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = {};\nfor(var key in grantByCustomer) {\n    var entry = grantByCustomer[key];\n    value[key] = getCidEntry(entry);\n}\nreturn value;\n\n","supplementalCode":"function getCidEntry(grantList) {\n    //create a temp structure of cid/prudcts for this customer\n    var map = {};\n    var cidEntry;\n    for(var i = 0; i < grantList.length; i++) {\n        var grantRow = grantList[i];\n        var cid = grantRow[CID_INDEX];\n        var product = grantRow[PRODUCT_INDEX];\n        \n        cidEntry = map[cid];\n        if(cidEntry === undefined) {\n            cidEntry = {};\n            map[cid] = cidEntry;\n        }\n        \n        cidEntry[product] = true;\n    }\n    \n    //convert to a map from cids to list of products\n    resultEntry = {};\n    for(var ckey in map) {\n        cidEntry = map[ckey];\n        var productList = [];\n        for(pkey in cidEntry) {\n            productList.push(pkey);\n        }\n        resultEntry[ckey] = productList;\n    }\n    \n    return resultEntry;\n}","description":""}},"lookupFolder":{"name":"lookupFolder","type":"apogee.Folder","children":{"customerName":{"name":"customerName","type":"apogee.JsonTable","updateData":{"data":"Indoo.rs","description":""}},"customerProductGrid":{"name":"customerProductGrid","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = [];\n\n//header row\nvar header = [];\nvalue.push(header);\n\n//header row must be as long as longest row\nvar maxRowLength = 0;\nvar customerEntry = customerProducts[customerName];\nfor(var cid in customerEntry) {\n    var row = [];\n    row.push(cid);\n    row = row.concat(customerEntry[cid]);\n    value.push(row);\n    if(row.length > maxRowLength) {\n        maxRowLength= row.length;\n    }\n}\n\n//fill header row\nheader.length = maxRowLength;\nheader.fill(\"Product\");\nheader[0] = \"CID\";\nreturn value;\n\n","supplementalCode":"","description":""}}}},"queryFolder":{"name":"queryFolder","type":"apogee.Folder","children":{"updateCutoffDate":{"name":"updateCutoffDate","type":"apogee.JsonTable","updateData":{"data":"2016-07-05","description":""}},"getQuery":{"name":"getQuery","type":"apogee.FunctionTable","updateData":{"argList":["productPrefix"],"functionBody":"var string1 = \"select release_name, from_unixtime(max(commit.timestamp)/1000) as latest_update, max(commit.timestamp)/1000 < unix_timestamp('\";\nvar string2 = updateCutoffDate;\nvar string3 = \"') as needs_update from commit_release join commit on commit_release.commit_id = commit.commit_id where commit_release.release_name in (\";\nvar string4 = getReleaseList(productPrefix,activeCommunities);\nvar string5 = \") group by release_name order by needs_update desc, release_name\";\n\nreturn string1 + string2 + string3 + string4 + string5;","supplementalCode":"function getReleaseList(productPrefix,activeCommunities) {\n    var text = \"\";\n    for(var i = 0; i < activeCommunities.length; i++) {\n        if(i > 0) text += \",\";\n        text += getEntry(productPrefix,activeCommunities[i]);\n    }\n    return text;\n}\n\nfunction getEntry(prefix,cid) {\n    return \"'\" + prefix + cid + \"'\";\n}","description":""}},"micemapsQuery":{"name":"micemapsQuery","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = getQuery(\"community_map|\")\nreturn value;\n\n","supplementalCode":"","description":""}},"micentityQuery":{"name":"micentityQuery","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = getQuery(\"community_entity_active|\");\nreturn value;\n\n","supplementalCode":"","description":""}}}},"cidList":{"name":"cidList","type":"apogee.JsonTable","updateData":{"data":[78,6418,9662,23903,20544,15],"description":""}},"cidLookupResult":{"name":"cidLookupResult","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var value;\nvalue = {};\n\nentry = customerGrants[0];\nif(entry[ACCOUNT_INDEX] !== \"Account\") {\n    throw new Error(\"Header row missing!\");\n}\nif(entry[PRODUCT_INDEX] !== \"Product Type\") {\n    throw new Error(\"Header row missing!\");\n}\nif(entry[CID_INDEX] !== \"Community ID\") {\n    throw new Error(\"Header row missing!\");\n}\n\nfor(var c=0; c<cidList.length; c++) {\n    var cid = cidList[c];\n    var cidEntry =[];\n    for (var i = 1; i < customerGrants.length; i++) {\n        var entry = customerGrants[i];\n        var customer = entry[ACCOUNT_INDEX];\n        \n        if(accountExcluded(customer)) {\n            continue;\n        }\n        \n        if(cid == entry[CID_INDEX]) {\n            if(cidEntry.indexOf(customer) < 0) {\n                // console.log(value);\n                cidEntry.push(customer);\n            }\n        }\n    }\n    if(!value[cid]) value[cid] = [];\n    value[cid].push(cidEntry);\n\n}\nreturn value;\n\n","supplementalCode":"","description":""}},"accountExcluded":{"name":"accountExcluded","type":"apogee.FunctionTable","updateData":{"argList":["account"],"functionBody":"for(var i=0; i<exclusionAccounts.length; i++) {\n    if(exclusionAccounts[i] == account) {\n        return true;\n    }\n}","supplementalCode":"","description":""}},"customerGrants":{"name":"customerGrants","type":"apogee.JsonTable","updateData":{"data":[["Account","Micello Key","Project","Product Type","Product SKU","Community ID"],["","","","","",""]],"description":""}}}}},"components":{"type":"apogeeapp.app.FolderComponent","tabOpen":true,"treeState":1,"children":{"grantByCustomer":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":847,"y":437},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"exclusionAccounts":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":89},"posInfo":{"x":20,"y":13},"state":0,"viewType":"Data"},"dataView":"Colorized"},"customerAccounts":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":361,"height":511},"posInfo":{"x":789,"y":585},"state":0,"viewType":"Data"},"dataView":"Colorized"},"activeCommunities":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":848,"y":521},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"CID_INDEX":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":38},"posInfo":{"x":349,"y":168},"state":0,"viewType":"Data"},"dataView":"Colorized"},"PRODUCT_INDEX":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":32},"posInfo":{"x":350,"y":93},"state":0,"viewType":"Data"},"dataView":"Colorized"},"ACCOUNT_INDEX":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":40},"posInfo":{"x":352,"y":13},"state":0,"viewType":"Data"},"dataView":"Colorized"},"customerProducts":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":852,"y":478},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"lookupFolder":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":59,"y":697}},"treeState":1,"children":{"customerName":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":25,"y":25},"state":0,"viewType":"Data"},"dataView":"Colorized"},"customerProductGrid":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":684,"height":354},"posInfo":{"x":387,"y":29},"state":0,"viewType":"Data"},"dataView":"Grid"}}},"queryFolder":{"type":"apogeeapp.app.FolderComponent","windowState":{"posInfo":{"x":62,"y":743}},"treeState":1,"children":{"updateCutoffDate":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":25,"y":25},"state":0,"viewType":"Data"},"dataView":"Colorized"},"getQuery":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":400,"height":400},"posInfo":{"x":108,"y":483},"state":0,"viewType":"Code"}},"micemapsQuery":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":1165,"y":57},"state":0,"viewType":"Data"},"dataView":"Colorized"},"micentityQuery":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":300},"posInfo":{"x":785,"y":322},"state":0,"viewType":"Data"},"dataView":"Colorized"}}},"cidList":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":300,"height":135},"posInfo":{"x":837,"y":16},"state":0,"viewType":"Data"},"dataView":"Colorized"},"cidLookupResult":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":343,"height":489},"posInfo":{"x":1213,"y":20},"state":0,"viewType":"Data"},"dataView":"Colorized"},"accountExcluded":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":333,"height":111},"posInfo":{"x":834,"y":203},"state":0,"viewType":"Code"}},"customerGrants":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":689,"height":302},"posInfo":{"x":36,"y":273},"state":0,"viewType":"Data"},"dataView":"Grid"}}},"activeTabMember":"Model"}