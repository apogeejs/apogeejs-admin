{"fileType":"apogee app js workspace","version":"0.40","references":[{"url":"https://unpkg.com/leaflet@1.2.0/dist/leaflet.js","entryType":"js link"},{"url":"https://unpkg.com/leaflet@1.2.0/dist/leaflet.css","entryType":"css link"}],"workspace":{"fileType":"apogee workspace","version":0.2,"name":"GeojsonFolderFunction","data":{"name":"Model","type":"apogee.Folder","children":{"osmToGeojson":{"name":"osmToGeojson","type":"apogee.FolderFunction","argList":["osmData","isPolygonPropertyTree"],"returnValue":"geojson","internalFolder":{"name":"root","type":"apogee.Folder","children":{"geojsonPointLookupTable":{"name":"geojsonPointLookupTable","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\n\nvar isNode = (element) => (element.type == \"node\");\nvar addToMap = (element) => output[element.id] = [element.lon,element.lat];\n\nosmData.elements.filter(isNode).forEach(addToMap);\n\nreturn output;","supplementalCode":"","description":""}},"geojson":{"name":"geojson","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var output = {};\noutput.type = \"FeatureCollection\";\noutput.properties = {};\n\nvar hasTags = (element) => (element.tags !== undefined);\n\nvar toGeojsonFeature = (osmFeature) => {\n    var geojsonFeature = {};\n    geojsonFeature.type = \"Feature\";\n    geojsonFeature.id = osmFeature.id;\n    geojsonFeature.properties = osmFeature.tags;\n    geojsonFeature.geometry = getGeojsonGeometry(osmFeature);\n    return geojsonFeature;\n}\n\noutput.features = osmData.elements.filter(hasTags).map(toGeojsonFeature);\n\nreturn output;","supplementalCode":"function getGeojsonGeometry(osmFeature) {\n    var geometry = {};\n    if(osmFeature.type == \"node\") {\n        geometry.type = \"Point\";\n        geometry.coordinates = getPointCoordinates(osmFeature.id);\n    }\n    else if(osmFeature.type == \"way\") {\n        if(isPolygon(osmFeature)) {\n            geometry.type = \"Polygon\";\n            geometry.coordinates = getPolygonCoordinates(osmFeature.nodes)\n        }\n        else {\n            geometry.type = \"LineString\";\n            geometry.coordinates = getLineStringCoordinates(osmFeature.nodes);\n        }\n    }\n    else {\n        throw new Error(\"Unexpected osm type: \" + osmFeature.type);\n    }\n    return geometry;\n}\n\n/** Point - lookup lon lat point for given node id */\nfunction getPointCoordinates(nodeId) {\n    return geojsonPointLookupTable[nodeId];\n}\n\n/** Line String - list of lat lon points for a list of node ids */\nfunction getLineStringCoordinates(nodeIdList) {\n    return nodeIdList.map(getPointCoordinates);\n}\n\n/** Polygon - get a list o fline strings (with one entry - the outer loop)\n * We are not supporting interior rings for now. */\nfunction getPolygonCoordinates(nodeIdList) {\n    return [getLineStringCoordinates(nodeIdList)];\n}\n\n","description":""}},"readPropertyTree":{"name":"readPropertyTree","type":"apogee.FunctionTable","updateData":{"argList":["tree","properties"],"functionBody":"for(var key in tree) {\n    \n    var featureValue = properties[key];\n    if(featureValue !== undefined) {\n        var treeEntry = tree[key];\n        //check the value specific entry\n        if(treeEntry.values) {\n            var payload = treeEntry.values[featureValue];\n            if(payload !== undefined) {\n                return payload;\n            }\n        }\n        \n        //check the default entry\n        if(treeEntry.default !== undefined) {\n            return treeEntry.default;\n        }\n    }\n}\n\n//none found\nreturn null;","supplementalCode":"","description":""}},"isPolygonPropertyTree":{"name":"isPolygonPropertyTree","type":"apogee.JsonTable","updateData":{"data":{"building":{"default":true}},"description":"This tree indicates which keys and associated\nvalues are polygons (true) or linestrings (false\nor undefined).\n\nFORMAT:\n\n{\n    [key1]:{\n        \"values\":{\n            [value11]:true,\n            [value21]:true,\n            ...\n         },\n         \"default\":true,\n    },\n    [key2]:{\n        \"values\":{\n            [value21]:true,\n            [value22]:true,\n            ...\n         },\n         \"default\":true,\n    },\n    ...\n}\n             "}},"isPolygon":{"name":"isPolygon","type":"apogee.FunctionTable","updateData":{"argList":["osmFeature"],"functionBody":"return readPropertyTree(isPolygonPropertyTree,osmFeature.tags);","supplementalCode":"","description":""}},"osmData":{"name":"osmData","type":"apogee.JsonTable","updateData":{"data":{"version":0.6,"generator":"Overpass API","osm3s":{"timestamp_osm_base":"2017-11-12T20:18:02Z","copyright":"The data included in this document is from www.openstreetmap.org. The data is made available under ODbL."},"elements":[{"type":"node","id":65531994,"lat":37.3943074,"lon":-122.0772566},{"type":"node","id":3742260680,"lat":37.3942367,"lon":-122.077307},{"type":"node","id":343267960,"lat":37.3934254,"lon":-122.0790112,"tags":{"addr:housenumber":"223","addr:street":"Castro Street","amenity":"pub","created_by":"Potlatch 0.10f","name":"St. Stephens Green"}},{"type":"way","id":8969746,"nodes":[65531994,3742260680],"tags":{"highway":"residential","lanes":"2","name":"Hope Street","sidewalk":"both","tiger:county":"Santa Clara, CA","tiger:name_base":"Hope","tiger:name_type":"St"}}]},"description":""}}}}},"swneBoundingBox":{"name":"swneBoundingBox","type":"apogee.JsonTable","updateData":{"data":[37.39303678804945,-122.08008885383607,37.39453272390984,-122.0778250694275],"description":""}},"osmData":{"name":"osmData","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"var options = {};\noptions.method = \"POST\";\noptions.body = getBody(swneBoundingBox);\n\nreturn apogee.net.jsonRequest(url,options);","supplementalCode":"function getBody(boundingBoxArray) {\n    var bboxString = boundingBoxArray.join(\",\");\n    var body = apogee.util.formatString(\"[out:json];(node({0});(way({0});>;););out;\",bboxString);\n    return body;\n}","description":""}},"url":{"name":"url","type":"apogee.JsonTable","updateData":{"data":"http://overpass-api.de/api/interpreter","description":""}},"geojson":{"name":"geojson","type":"apogee.JsonTable","updateData":{"argList":[],"functionBody":"return osmToGeojson(osmData,isPolygonPropertyTree);","supplementalCode":"","description":""}},"isPolygonPropertyTree":{"name":"isPolygonPropertyTree","type":"apogee.JsonTable","updateData":{"data":{"building":{"default":true}},"description":"This tree indicates which keys and associated\nvalues are polygons (true) or linestrings (false\nor undefined).\n\nFORMAT:\n\n{\n    [key1]:{\n        \"values\":{\n            [value11]:true,\n            [value21]:true,\n            ...\n         },\n         \"default\":true,\n    },\n    [key2]:{\n        \"values\":{\n            [value21]:true,\n            [value22]:true,\n            ...\n         },\n         \"default\":true,\n    },\n    ...\n}\n             "}}}}},"components":{"type":"apogeeapp.app.FolderComponent","tabOpen":true,"treeState":1,"children":{"osmToGeojson":{"type":"apogeeapp.app.FolderFunctionComponent","windowState":{"posInfo":{"x":554,"y":501}},"tabOpen":true,"treeState":1,"children":{"geojsonPointLookupTable":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":588,"height":401},"posInfo":{"x":36,"y":332},"state":-1,"viewType":"Formula"},"dataView":"Colorized"},"geojson":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":488,"height":241},"posInfo":{"x":41,"y":383},"state":0,"viewType":"Data"},"dataView":"Colorized"},"readPropertyTree":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":504,"height":400},"posInfo":{"x":589,"y":187},"state":-1,"viewType":"Code"}},"isPolygonPropertyTree":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":347,"height":84},"posInfo":{"x":583,"y":18},"state":0,"viewType":"Data"},"dataView":"Colorized"},"isPolygon":{"type":"apogeeapp.app.FunctionComponent","windowState":{"sizeInfo":{"width":489,"height":49},"posInfo":{"x":590,"y":237},"state":-1,"viewType":"Code"}},"osmData":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":483,"height":253},"posInfo":{"x":36,"y":22},"state":0,"viewType":"Data"},"dataView":"Colorized"}}},"swneBoundingBox":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":276,"height":115},"posInfo":{"x":28,"y":38},"state":0,"viewType":"Data"},"dataView":"Colorized"},"osmData":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":459,"height":155},"posInfo":{"x":29,"y":263},"state":0,"viewType":"Data"},"dataView":"Colorized"},"url":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":367,"height":49},"posInfo":{"x":30,"y":207},"state":-1,"viewType":"Data"},"dataView":"Colorized"},"geojson":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":475,"height":220},"posInfo":{"x":31,"y":505},"state":0,"viewType":"Data"},"dataView":"Colorized"},"isPolygonPropertyTree":{"type":"apogeeapp.app.JsonTableComponent","windowState":{"sizeInfo":{"width":396,"height":408},"posInfo":{"x":541,"y":23},"state":0,"viewType":"Notes"},"dataView":"Colorized"}}},"activeTabMember":"Model"}