{"fileType":"apogee app js workspace","version":"0.60","references":{"refEntries":[{"url":"/applications/modules/chartjsmodule/src/ChartJSComponentModule.js","nickname":"ChartJSComponentModule.j","entryType":"es module"}],"viewState":{"treeState":1,"lists":{"es module":{"treeState":1},"js link":{"treeState":0},"css link":{"treeState":0}}}},"code":{"model":{"fileType":"apogee model","version":0.3,"name":"ApacheLogExample","children":{"main":{"name":"main","type":"apogee.Folder","children":{"apacheLog":{"name":"apacheLog","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"//This library function is similar to fetch. It returns a promise for the request. In this case it returns the text body.\n//On failure it throws an exception, which is the preferred way of handling errors in Apogee.\n//There is also a function apogeeutil.jsonRequest(url) which returns a JSON object from the request.\nreturn apogeeutil.textRequest(logUrl);","supplementalCode":""}},"parsedLog":{"name":"parsedLog","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"var createEntry = row => {\n    var entry = {};\n    entry.ipAddress = row[0];\n    entry.date = _trimCharacters(row[3] + \" \" + row[4],1,1);\n    entry.method = _trimCharacters(row[5],1,0);\n    entry.path = row[6];\n    entry.protocol = _trimCharacters(row[7],0,1);\n    entry.responseCode = row[8];\n    \n    //We didn't handle a query string. We will detect that here. If we run into a query string we will\n    //see the error and then we can do the work to handle is. Otherwise we can just skip it.\n    if(entry.path.includes(\"?\")) throw new Error(\"Doh! There is a query string!\");\n    \n    return entry;\n}\n\nreturn initialParse.map(createEntry);","supplementalCode":"function _trimCharacters(text,fromStart,fromEnd) {\r\n    return text.substring(fromStart,text.length-fromEnd);\r\n}"}},"endpointCounts":{"name":"endpointCounts","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"let countMap = {};\n\nlet addRecordToMap = record => { \n    countMap[record.path] = countMap[record.path] ? countMap[record.path]+1 : 1;\n}\n\nparsedLog.forEach(addRecordToMap);\n\nreturn countMap;","supplementalCode":""}},"initialParse":{"name":"initialParse","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"return apacheLog.split(\"\\n\").map(line => line.split(\" \"));","supplementalCode":""}},"logUrl":{"name":"logUrl","type":"apogee.JsonMember","updateData":{"data":"https://www.apogeejs.com/web/examples/apacheLogData/sampleShort.log"}},"endpointsPlot":{"name":"endpointsPlot","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"let output = {};\noutput[\"inputType\"] = \"form\"\noutput[\"formData\"]= {};\noutput[\"formData\"][\"xValuesType\"] = \"category\"\noutput[\"formData\"][\"categoryDataSeries\"]= []\noutput[\"formData\"][\"categoryDataSeries\"][0]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"dataType\"] = \"map\"\noutput[\"formData\"][\"categoryDataSeries\"][0][\"dataMap\"] = endpointCounts\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"label\"] = \"Endpoint Counts\"\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"line\"]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"line\"][\"selectColor\"] = false\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"line\"][\"selectAreaColor\"] = false\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"point\"]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"point\"][\"selectColor\"] = false\noutput[\"formData\"][\"options\"]= {};\noutput[\"formData\"][\"options\"][\"xValuesType\"] = \"category\"\noutput[\"formData\"][\"options\"][\"title\"]= {};\noutput[\"formData\"][\"options\"][\"title\"][\"display\"] = false\noutput[\"formData\"][\"options\"][\"title\"][\"selectColor\"] = false\noutput[\"formData\"][\"options\"][\"legend\"]= {};\noutput[\"formData\"][\"options\"][\"legend\"][\"display\"] = true\noutput[\"formData\"][\"options\"][\"line\"]= {};\noutput[\"formData\"][\"options\"][\"line\"][\"selectColor\"] = false\noutput[\"formData\"][\"options\"][\"line\"][\"selectAreaColor\"] = false\noutput[\"formData\"][\"options\"][\"point\"]= {};\noutput[\"formData\"][\"options\"][\"point\"][\"selectColor\"] = false\noutput[\"formData\"][\"options\"][\"yAxes\"]= {};\noutput[\"formData\"][\"options\"][\"yAxes\"][\"type\"] = \"linear\"\noutput[\"formData\"][\"options\"][\"yAxes\"][\"stacked\"] = false\noutput[\"storedFormValue\"] = {\"inputType\":\"form\",\"formData\":{\"xValuesType\":\"category\",\"xCategories\":\"\",\"categoryDataSeries\":[{\"dataType\":\"map\",\"dataMap\":\"endpointCounts\",\"yAccessor\":\"\",\"options\":{\"label\":\"Endpoint Counts\",\"line\":{\"selectColor\":false,\"borderWidth\":\"default\",\"fill\":\"default\",\"selectAreaColor\":false,\"doLineTension\":\"default\",\"spanGaps\":\"default\",\"stepped\":\"default\"},\"point\":{\"showPoints\":\"default\",\"pointStyle\":\"default\",\"radius\":\"default\",\"selectColor\":false,\"borderWidth\":\"default\"}}}],\"options\":{\"xValuesType\":\"category\",\"title\":{\"display\":false,\"text\":\"\",\"fontSize\":\"default\",\"selectColor\":false},\"legend\":{\"display\":true,\"position\":\"default\"},\"line\":{\"selectColor\":false,\"borderWidth\":\"default\",\"fill\":\"default\",\"selectAreaColor\":false,\"doLineTension\":\"default\",\"spanGaps\":\"default\",\"stepped\":\"default\"},\"point\":{\"showPoints\":\"default\",\"pointStyle\":\"default\",\"radius\":\"default\",\"selectColor\":false,\"borderWidth\":\"default\"},\"yAxes\":{\"type\":\"linear\",\"stacked\":false}}}}\nreturn output;"}},"timeOfDayCounts":{"name":"timeOfDayCounts","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"let countMap = {};\n\nlet addRecordToMap = record => {\n    let timeBinName = _getRecordTimeBin(record.date);\n    countMap[timeBinName] = countMap[timeBinName] ? countMap[timeBinName]+1 : 1;\n}\n\nparsedLog.forEach(addRecordToMap);\n\nreturn countMap;","supplementalCode":"const HOUR_START_INDEX = 12;\nconst HOUR_LENGTH = 2;\n\nfunction _getRecordTimeBin(dateString) {\n    //quick and dirty time processing\n    //we'll convert this to javascript date if we want to do more with it.\n    let hourString = dateString.substr(HOUR_START_INDEX,HOUR_LENGTH) + \":00\";\n    console.log(hourString);\n    return hourString;\n}"}},"timeOfDayPlot":{"name":"timeOfDayPlot","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"let output = {};\noutput[\"inputType\"] = \"form\"\noutput[\"formData\"]= {};\noutput[\"formData\"][\"categoryDataSeries\"]= []\noutput[\"formData\"][\"categoryDataSeries\"][0]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"dataType\"] = \"map\"\noutput[\"formData\"][\"categoryDataSeries\"][0][\"dataMap\"] = timeOfDayCounts\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"label\"] = \"Counts by Hour\"\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"rectangle\"]= {};\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"rectangle\"][\"selectAreaColor\"] = false\noutput[\"formData\"][\"categoryDataSeries\"][0][\"options\"][\"rectangle\"][\"selectBorderColor\"] = false\noutput[\"formData\"][\"options\"]= {};\noutput[\"formData\"][\"options\"][\"title\"]= {};\noutput[\"formData\"][\"options\"][\"title\"][\"display\"] = false\noutput[\"formData\"][\"options\"][\"title\"][\"selectColor\"] = false\noutput[\"formData\"][\"options\"][\"legend\"]= {};\noutput[\"formData\"][\"options\"][\"legend\"][\"display\"] = true\noutput[\"formData\"][\"options\"][\"rectangle\"]= {};\noutput[\"formData\"][\"options\"][\"rectangle\"][\"selectAreaColor\"] = false\noutput[\"formData\"][\"options\"][\"rectangle\"][\"selectBorderColor\"] = false\noutput[\"formData\"][\"options\"][\"yAxes\"]= {};\noutput[\"formData\"][\"options\"][\"yAxes\"][\"type\"] = \"linear\"\noutput[\"formData\"][\"options\"][\"yAxes\"][\"stacked\"] = false\noutput[\"storedFormValue\"] = {\"inputType\":\"form\",\"formData\":{\"xCategories\":\"\",\"categoryDataSeries\":[{\"dataType\":\"map\",\"dataMap\":\"timeOfDayCounts\",\"yAccessor\":\"\",\"options\":{\"label\":\"Counts by Hour\",\"rectangle\":{\"selectAreaColor\":false,\"selectBorderColor\":false,\"borderWidth\":\"default\"}}}],\"options\":{\"title\":{\"display\":false,\"text\":\"\",\"fontSize\":\"default\",\"selectColor\":false},\"legend\":{\"display\":true,\"position\":\"default\"},\"rectangle\":{\"selectAreaColor\":false,\"selectBorderColor\":false,\"borderWidth\":\"default\"},\"yAxes\":{\"type\":\"linear\",\"stacked\":false}}}}\nreturn output;","supplementalCode":""}}}}}},"components":{"main":{"type":"apogeeapp.PageComponent","data":{"doc":{"type":"doc","content":[{"type":"heading1","content":[{"type":"text","text":" Apache Log Parsing Example"}]},{"type":"paragraph","content":[{"type":"text","text":"This is an example Apogee workspace that parses an Apache log."}]},{"type":"heading2","content":[{"type":"text","text":"Log Data"}]},{"type":"paragraph","content":[{"type":"text","text":"We will retrieve our data file from a url."}]},{"type":"apogeeComponent","attrs":{"name":"logUrl","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"This is the raw Apache log data. Note that we are displaying this as text rather than as a JSON, the default view. Text is a valid JSON but if we show it as a JSON we will get a lot of escape characters and it is hard to read. "}]},{"type":"apogeeComponent","attrs":{"name":"apacheLog","id":0,"state":""}},{"type":"heading2","content":[{"type":"text","text":"Log Processing"}]},{"type":"paragraph","content":[{"type":"text","text":"Here we will parse the Apache log into a format that is easier to work with."}]},{"type":"paragraph","content":[{"type":"text","text":"In the spirit of iterative programming, we will take two steps to parse the file. In the first we will do the obvious split so each record is an array of fields. Then we will work more specifically to parse the individual fields."}]},{"type":"apogeeComponent","attrs":{"name":"initialParse","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"To clean up the above fields, we will add a function in the private section of the next cell. This will trim the specified number of characters from the start and end of the field string."}]},{"type":"paragraph","content":[{"type":"text","text":"Once we have that we can clean up each field. We will also stick it into a JSON object where we can name each field. This gives us a clean parsed format for the file."}]},{"type":"apogeeComponent","attrs":{"name":"parsedLog","id":0,"state":""}},{"type":"heading2","content":[{"type":"text","text":"Log Analysis "}]},{"type":"paragraph","content":[{"type":"text","text":"Now that we have the parsed log in a nice format we can do some analysis. "}]},{"type":"heading3","content":[{"type":"text","text":"Endpoint Counts"}]},{"type":"paragraph","content":[{"type":"text","text":"Here we will count the number of times each endpoint is called."}]},{"type":"apogeeComponent","attrs":{"name":"endpointCounts","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"Here is a plot of the endpoint counts;"}]},{"type":"apogeeComponent","attrs":{"name":"endpointsPlot","id":0,"state":""}},{"type":"heading3","content":[{"type":"text","text":"Requests by Time of Day"}]},{"type":"paragraph","content":[{"type":"text","text":"Here we will count the number of requests by time of day, putting it in one hour bins."}]},{"type":"apogeeComponent","attrs":{"name":"timeOfDayCounts","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"Here is a plot of the counts versus time of day.  The data looks like it wasn't from a very big time span."}]},{"type":"apogeeComponent","attrs":{"name":"timeOfDayPlot","id":0,"state":""}},{"type":"paragraph"}]}},"children":{"apacheLog":{"type":"apogeeapp.JsonCell","dataView":"Text Data","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":false,"height":280},"Formula":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false}}}}},"parsedLog":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false,"height":7000}}}}},"endpointCounts":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false}}}}},"initialParse":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":false,"height":280},"Formula":{"isViewActive":true,"height":7000},"Private":{"isViewActive":false}}}}},"logUrl":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false},"Private":{"isViewActive":false}}}}},"endpointsPlot":{"type":"apogeeapp.ChartJSCell","chartType":"bar","viewState":{"childDisplayState":{"views":{"Chart":{"isViewActive":true},"Input":{"isViewActive":false}}}}},"timeOfDayCounts":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false,"height":7000}}}}},"timeOfDayPlot":{"type":"apogeeapp.ChartJSCell","chartType":"bar","viewState":{"childDisplayState":{"views":{"Chart":{"isViewActive":true},"Input":{"isViewActive":false}}}}}},"viewState":{"childDisplayState":null,"treeState":1,"tabOpened":true,"tabShowing":true}},"viewState":{"treeState":1}}},"viewState":{"treeState":1}}