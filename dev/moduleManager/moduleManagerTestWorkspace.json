{"fileType":"apogee app js workspace","version":"1.0","references":{"refEntries":[{"entryType":"js link","url":"https://unpkg.com/react@16.12.0/umd/react.development.js","name":"react.development.js"},{"entryType":"js link","url":"https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js","name":"react-dom.development.js"}],"viewState":{"treeState":1,"lists":{"apogee module":{"treeState":0},"es module":{"treeState":0},"js link":{"treeState":1},"css link":{"treeState":0}}}},"code":{"model":{"fileType":"apogee model","version":"1.0","name":"Workspace","children":{"modules":{"name":"modules","type":"apogee.Folder","children":{"App":{"name":"App","type":"apogee.Folder","childrenNotWriteable":true,"children":{"jsx":{"name":"jsx","type":"apogee.FunctionMember","fields":{"argList":["props"],"functionBody":"\nfunction __createJsx(props) {\n  //props: moduleInfoArray\n  const moduleInfoArray = props.moduleInfoArray;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h1\", null, \"Module Manager\"), /*#__PURE__*/React.createElement(\"div\", {\n    is: \"moduleListContainer\"\n  }, props.moduleInfoArray.map(moduleInfo => /*#__PURE__*/React.createElement(ModuleElement, {\n    moduleInfo: moduleInfo,\n    key: moduleInfo.name\n  }))));\n}\nreturn __createJsx(props)\n","supplementalCode":""}},"props":{"name":"props","type":"apogee.DataMember","fields":{"argList":[],"functionBody":"return {\n    moduleInfoArray: initialization.moduleInfoArray\n}","supplementalCode":""}}}},"ModuleElement":{"name":"ModuleElement","type":"apogee.FunctionMember","fields":{"argList":["props"],"functionBody":"\nfunction __createJsx(props) {\n  \"//>//\"; //properties moduleInfo\n\n  const moduleInfo = props.moduleInfo;\n  const activeVersionInfo = moduleInfo.versions[0];\n  const title = activeVersionInfo.displayName ? `${activeVersionInfo.displayName}: ${moduleInfo.name}` : moduleInfo.name;\n  const expanded = true;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"moduleCell\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"headerCell\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"titleField\"\n  }, title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"statusField\"\n  }, \"status not available\"), activeVersionInfo.desc ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"shortDescField\"\n  }, activeVersionInfo.desc) : \"\", expanded ? /*#__PURE__*/React.createElement(BodyElement, {\n    moduleInfo: moduleInfo,\n    activeVersionInfo: activeVersionInfo\n  }) : /*#__PURE__*/React.createElement(ShowMoreElement, null)));\n  \"//>//\";\n}\nreturn __createJsx(props)\n"}},"BodyElement":{"name":"BodyElement","type":"apogee.FunctionMember","fields":{"argList":["props"],"functionBody":"\nfunction __createJsx(props) {\n  \"//>//\";\n\n  const moduleInfo = props.moduleInfo;\n  const activeVersionInfo = props.activeVersionInfo;\n\n  const createWorkspaceLinks = () => {\n    if (!activeVersionInfo.demoWorkspaces || activeVersionInfo.demoWorkspaces.length == 0) return '';\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"referenceCommandSetContainer\"\n    }, /*#__PURE__*/React.createElement(\"h4\", null, \"Demo Workspaces\"), activeVersionInfo.demoWorkspaces.map(workspaceInfo => /*#__PURE__*/React.createElement(\"a\", {\n      key: workspaceInfo.url,\n      href: workspaceInfo.url\n    }, workspaceInfo.url)));\n  };\n\n  const createWebLink = () => {\n    if (!activeVersionInfo.webLink) return '';\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"referenceCommandSetContainer\"\n    }, /*#__PURE__*/React.createElement(\"label\", null, \"Web Link: \"), /*#__PURE__*/React.createElement(\"a\", {\n      key: activeVersionInfo.webLink,\n      href: activeVersionInfo.webLink\n    }, activeVersionInfo.webLink));\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bodyCell\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"versionLabel\"\n  }, activeVersionInfo.version), /*#__PURE__*/React.createElement(\"div\", null, activeVersionInfo.url), createWorkspaceLinks(), createWebLink());\n  \"//>//\";\n}\nreturn __createJsx(props)\n"}},"ShowMoreElement":{"name":"ShowMoreElement","type":"apogee.FunctionMember","fields":{"argList":["props"],"functionBody":"\nfunction __createJsx(props) {\n  \"//>//\";\n\n  return /*#__PURE__*/React.createElement(\"div\", null, \"show more\");\n  \"//>//\";\n}\nreturn __createJsx(props)\n"}}}},"initialization":{"name":"initialization","type":"apogee.Folder","children":{"globalStuff":{"name":"globalStuff","type":"apogee.DataMember","fields":{"argList":[],"functionBody":"//data.onInitModulesMsg;\n//data.onAppStatusMsg;\n","supplementalCode":""}},"initModuleData":{"name":"initModuleData","type":"apogee.DataMember","fields":{"data":{"platform":"es","repositories":["http://localhost:8888/apogeejs-admin/dev/moduleManager/moduleDataTest.json"]}}},"appStatusData":{"name":"appStatusData","type":"apogee.DataMember","fields":{"data":{"loaded":[{"name":"apogeejs-module-chartjs","moduleType":"apogee module","platform":"es","versionData":{"version":"4.0.0-p.2","url":"http://localhost:8888/apogeejs-module-chartjs/src/ChartJSComponentModule2.js","demoWorkspaces":[{"url":"http://localhost:8888/apogeejs-module-chartjs/chartDemoWorkspaceLocal.json"}],"webLink":"https://apogeejs.com"},"sourceData":{"name":"test repo"}},{"name":"multi-login-component","moduleType":"apogee module","platform":"es","versionData":{"version":"2.0.0-p.1","url":"http://localhost:8888/apogeejs-admin/dev/moduleCreator/multiComponent/MultiLoginComponentModule.js"},"sourceData":{"name":"test repo"}}]}}},"moduleDataArray":{"name":"moduleDataArray","type":"apogee.DataMember","fields":{"argList":[],"functionBody":"return Promise.all(initialization.initModuleData.repositories.map(url => apogeeutil.jsonRequest(url)));","supplementalCode":""}},"moduleInfoArray":{"name":"moduleInfoArray","type":"apogee.DataMember","fields":{"data":[{"name":"apogeejs-module-chartjs","versions":[{"version":"4.0.0-p.1","displayName":"Chart.js Module","desc":"This modules creates plot using the Chart.js library. It includes Line, Bar and XY Scatter plots.","url":"http://localhost:8888/apogeejs-module-chartjs/src/ChartJSComponentModule.js","demoWorkspaces":[{"url":"http://localhost:8888/apogeejs-module-chartjs/chartDemoWorkspaceLocal.json"}],"webLink":"https://apogeejs.com"},{"version":"4.0.0-p.2","displayName":"Chart.js Module","desc":"This modules creates plot using the Chart.js library. It includes Line, Bar and XY Scatter plots.","url":"http://localhost:8888/apogeejs-module-chartjs/src/ChartJSComponentModule2.js","demoWorkspaces":[{"url":"http://localhost:8888/apogeejs-module-chartjs/chartDemoWorkspaceLocal.json"}],"webLink":"https://apogeejs.com"},{"version":"4.0.0-p.3","displayName":"Chart.js Module","desc":"This modules creates plot using the Chart.js library. It includes Line, Bar and XY Scatter plots.","url":"http://localhost:8888/apogeejs-module-chartjs/src/ChartJSComponentModule3.js","demoWorkspaces":[{"url":"http://localhost:8888/apogeejs-module-chartjs/chartDemoWorkspaceLocal.json"}],"webLink":"https://apogeejs.com"}]},{"name":"apogeejs-module-csv","versions":[{"version":"2.0.0-p.1","displayName":"CSV Module - Papaparse","desc":"This module parses CSV text into JSON. It uses the Papaparse CSV library.","url":"http://localhost:8888/apogeejs-module-csv/src/CSVComponentModule.js","demoWorkspaces":[{"url":"http://localhost:8888/apogeejs-module-csv/csvParseWorkspaceLocal.json"}],"webLink":"https://apogeejs.com"}]},{"name":"multi-login-component","versions":[{"version":"2.0.0-p.1","url":"http://localhost:8888/apogeejs-admin/dev/moduleCreator/multiComponent/MultiLoginComponentModule.js"}]}]}}}},"CSS":{"name":"CSS","type":"apogee.Folder","children":{"dummyCustomComponent":{"name":"dummyCustomComponent","type":"apogee.DataMember","fields":{"data":""}}}}}},"components":{"modules":{"type":"apogeeapp.PageComponent","fields":{"editorState":{"doc":{"type":"doc","content":[{"type":"heading1","content":[{"type":"text","text":"Modules"}]},{"type":"heading2","content":[{"type":"text","text":"App"}]},{"type":"paragraph","content":[{"type":"text","text":"This is the react display for the module manager."}]},{"type":"apogeeComponent","attrs":{"name":"App","id":0,"state":""}},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"ModuleElement","id":0,"state":""}},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"BodyElement","id":0,"state":""}},{"type":"apogeeComponent","attrs":{"name":"ShowMoreElement","id":0,"state":""}}]}}},"children":{"App":{"type":"apogeeapp.ReactDisplayCell","fields":{"jsxCode":"//props: moduleInfoArray\nconst moduleInfoArray = props.moduleInfoArray;\n\nreturn (\n    <>\n        <h1>Module Manager</h1>\n        <div is=\"moduleListContainer\">\n            {props.moduleInfoArray.map(moduleInfo => <ModuleElement moduleInfo={moduleInfo} key={moduleInfo.name} />)}\n        </div>\n    </>\n)"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Display":{"isViewActive":true},"jsxCode":{"isViewActive":true,"height":7000},"convertedCode":{"isViewActive":false},"Formula":{"isViewActive":true,"height":7000},"Private":{"isViewActive":false}}}}},"ModuleElement":{"type":"apogeeapp.ReactElementCell","fields":{"jsxCode":"//properties moduleInfo\nconst moduleInfo = props.moduleInfo;\n\nconst activeVersionInfo = moduleInfo.versions[0];\n\nconst title = activeVersionInfo.displayName ? `${activeVersionInfo.displayName}: ${moduleInfo.name}` : moduleInfo.name;\nconst expanded = true;\n\nreturn (\n    <div className=\"moduleCell\">\n        <div className=\"headerCell\">\n            <div className=\"titleField\">{title}</div>\n            <div className=\"statusField\">status not available</div>\n            {activeVersionInfo.desc ? <div className=\"shortDescField\">{activeVersionInfo.desc}</div> : \"\"}\n            {expanded ? <BodyElement moduleInfo={moduleInfo} activeVersionInfo={activeVersionInfo} /> : <ShowMoreElement /> }\n        </div>\n    </div>\n)"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"jsxCode":{"isViewActive":true,"height":7000},"convertedCode":{"isViewActive":false}}}}},"BodyElement":{"type":"apogeeapp.ReactElementCell","fields":{"jsxCode":"const moduleInfo = props.moduleInfo;\nconst activeVersionInfo = props.activeVersionInfo;\n\nconst createWorkspaceLinks = () => {\n    if((!activeVersionInfo.demoWorkspaces)||(activeVersionInfo.demoWorkspaces.length == 0)) return ''\n    \n    return (\n        <div className=\"referenceCommandSetContainer\">\n            <h4>Demo Workspaces</h4>\n            {activeVersionInfo.demoWorkspaces.map(workspaceInfo => <a key={workspaceInfo.url} href={workspaceInfo.url}>{workspaceInfo.url}</a>)}\n        </div>\n    )\n}\n\nconst createWebLink = () => {\n    if(!activeVersionInfo.webLink) return ''\n    \n    return (\n        <div className=\"referenceCommandSetContainer\">\n            <label>Web Link: </label><a key={activeVersionInfo.webLink} href={activeVersionInfo.webLink}>{activeVersionInfo.webLink}</a>\n        </div>\n    )\n}\n\nreturn (\n    <div className=\"bodyCell\">\n        <div className=\"versionLabel\">{activeVersionInfo.version}</div> \n        <div>{activeVersionInfo.url}</div>\n        { createWorkspaceLinks() }\n        { createWebLink() }\n    </div>\n)"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"jsxCode":{"isViewActive":true,"height":7000},"convertedCode":{"isViewActive":false}}}}},"ShowMoreElement":{"type":"apogeeapp.ReactElementCell","fields":{"jsxCode":"return <div>show more</div>"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"jsxCode":{"isViewActive":true,"height":7000},"convertedCode":{"isViewActive":false}}}}}},"viewState":{"childDisplayState":null,"treeState":1,"tabOpened":true,"tabShowing":true}},"initialization":{"type":"apogeeapp.PageComponent","fields":{"editorState":{"doc":{"type":"doc","content":[{"type":"heading1","content":[{"type":"text","text":"KLUDGE - Remote Module Manager"}]},{"type":"paragraph","content":[{"type":"text","text":"We need a way to run some external (to model) code on startup. We mock this up by creating a custom component and create a global object just once."}]},{"type":"paragraph","content":[{"type":"text","text":"In the global object we put the "},{"type":"text","marks":[{"type":"italic"}],"text":"sendMessage"},{"type":"text","text":" function and add a "},{"type":"text","marks":[{"type":"italic"}],"text":"receiveMessag"},{"type":"text","text":"e function which we use as a message listener."}]},{"type":"paragraph","content":[{"type":"text","text":"In onLoad, we define some functions to pass data into the model, which we use to handle some messages sent from the remote app. (Alternatively, we could have loaded functions from the model that did this for us. Here we would do that by loading them from data. Externally, we would load them from the workspace/model."}]},{"type":"apogeeComponent","attrs":{"name":"globalStuff","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"Here is where we pass data to init the modules and to set the app status."}]},{"type":"apogeeComponent","attrs":{"name":"initModuleData","id":0,"state":""}},{"type":"apogeeComponent","attrs":{"name":"appStatusData","id":0,"state":""}},{"type":"heading2","content":[{"type":"text","text":"Repository Data"}]},{"type":"paragraph","content":[{"type":"text","text":"This is the requested data from the repositories"}]},{"type":"apogeeComponent","attrs":{"name":"moduleDataArray","id":0,"state":""}},{"type":"paragraph"},{"type":"heading1","content":[{"type":"text","text":"TESTING DATA"}]},{"type":"apogeeComponent","attrs":{"name":"moduleInfoArray","id":0,"state":""}}]}}},"children":{"globalStuff":{"type":"apogeeapp.CustomCell","fields":{"destroyOnInactive":false,"html":"<p>This is a dummy component to do some global stuff</p>\n<ul>\n    <li>get the calling window and other init info</li>\n    <li>On load, create functions to pass message data into the model</li>\n    <li>create a globals function to send messages</li>\n    <li>start the message listener loop</li>\n</ul>","css":"","uiCode":"class GeneratorClass {\n    constructor() {\n        //KLUDGE\n        if(!window.mmGlobals) {\n            this._initGlobals();\n        }\n    }\n    \n    onLoad(outputElement,admin) {\n        if(window.mmGlobals) {\n            if(!window.mmGlobals.msgHandlers) {\n                //start listener and send \"started\" msg \n                //if this is the first time to set the handlers.\n                window.addEventListener(\"message\",window.mmGlobals.receiveMessage);\n                console.log(\"Message listener started!\");\n                window.mmGlobals.sendMessage(\"opened\",{});\n                console.log(\"Started message sent!!\");\n            }\n            window.mmGlobals.msgHandlers = {\n                initModules: data => admin.getMessenger().dataUpdate(\"initModuleData\",data),\n                appStatus: data => admin.getMessenger().dataUpdate(\"appStatusData\",data),\n            };\n        }\n    }\n    \n    /** Alternatively we could have called model functions we loaded here. */\n    //setData(msgHandlers,outputElement,admin) {\n    //\n    //}\n    \n    //===============================\n    // Private Methods\n    //===============================\n    _initGlobals() {\n        let mmGlobals = {};\n        \n        //get the calling window\n        mmGlobals.callingWindow = window.opener;\n    \n        //lod the url params\n        var params = new URLSearchParams(window.location.search);\n    \n        mmGlobals.callingUrl = params.get(\"callingUrl\");\n        if(!mmGlobals.callingUrl) {\n            this._fatalError(\"CallingUrl not found in input.\");\n            return false;\n        }\n    \n        mmGlobals.windowId = params.get(\"windowId\");\n        if(!mmGlobals.windowId) {\n            this._fatalError(\"Window ID not found in input.\");\n            return false;\n        }\n    \n        mmGlobals.sendMessage = function(messageType,commandData) {\n            let messageData = {};\n            messageData.commandData = commandData;\n        \n            //this identifies the window sending the message\n            messageData.windowId = mmGlobals.windowId;\n        \n            if((mmGlobals.callingWindow)&&(mmGlobals.callingWindow.postMessage)) {\n                console.log(\"sending message: \" + messageType);\n                mmGlobals.callingWindow.postMessage({message: messageType, value: messageData},mmGlobals.callingUrl);\n            }\n        }   \n            \n        mmGlobals.receiveMessage = function(event) {\n            console.log(\"received message: \" + event.data.message);\n            switch(event.data.message) {\n                case \"initModules\": \n                    mmGlobals.msgHandlers.initModules(event.data.value);\n                    break;\n        \n                case \"appStatus\": \n                    mmGlobals.msgHandlers.appStatus(event.data.value);\n                    break;\n        \n                case \"appClosed\": \n                    window.close();\n                    break;\n            }\n        }\n        \n        window.mmGlobals = mmGlobals;\n    }\n    \n    /** Temporary fatal error handling */\n    _fatalError(msg) {\n        throw new Error(msg);\n    }\n}\n\nreturn new GeneratorClass();\n\n"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Display":{"isViewActive":false},"HTML":{"isViewActive":false,"height":7000},"CSS":{"isViewActive":false},"uiGenerator()":{"isViewActive":false,"height":7000},"Formula":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false}}}}},"initModuleData":{"type":"apogeeapp.JsonCell","fields":{"dataView":"Colorized"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false},"Private":{"isViewActive":false}}}}},"appStatusData":{"type":"apogeeapp.JsonCell","fields":{"dataView":"Colorized"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Data":{"isViewActive":true,"height":7000},"Formula":{"isViewActive":false},"Private":{"isViewActive":false}}}}},"moduleDataArray":{"type":"apogeeapp.JsonCell","fields":{"dataView":"Colorized"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":true,"height":7000},"Private":{"isViewActive":false}}}}},"moduleInfoArray":{"type":"apogeeapp.JsonCell","fields":{"dataView":"Colorized"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":true,"height":7000},"Private":{"isViewActive":false}}}}}},"viewState":{"treeState":1,"tabOpened":true}},"CSS":{"type":"apogeeapp.PageComponent","fields":{"editorState":{"doc":{"type":"doc","content":[{"type":"heading1","content":[{"type":"text","text":"CSS KLUDGE"}]},{"type":"paragraph","content":[{"type":"text","text":"Here I am doing a kludge to add CSS, by putting in a custom component just to add CSS."}]},{"type":"apogeeComponent","attrs":{"name":"dummyCustomComponent","id":0,"state":""}}]}}},"children":{"dummyCustomComponent":{"type":"apogeeapp.CustomCell","fields":{"destroyOnInactive":false,"html":"<h3>This component does nothing except define CSS</h3>","css":".moduleCell {\r\n    border: 1px solid darkgray;\r\n    padding: 5px;\r\n    margin: 1px;\r\n}\r\n.headerCell {\r\n\r\n}\r\n.bodyCell {\r\n\r\n}\r\n.leftCell {\r\n    display: inline-block;\r\n    vertical-align: top;\r\n}\r\n.rightCell {\r\n    display: inline-block;\r\n    margin-left: 10px;\r\n    vertical-align: top;\r\n}\r\n.titleField {\r\n    font-weight: bold;\r\n    font-size: x-large;\r\n    display: inline-block;\r\n}\r\n.statusField {\r\n    color: gray;\r\n    font-weight: bold;\r\n    display: inline-block;\r\n    margin-left: 15px;\r\n}\r\n.shortDescField {\r\n    padding: 10px 0px;\r\n}\r\n.versionContainer {\r\n    padding: 10px 0px;\r\n}\r\n.versionLabel {\r\n\r\n}\r\n.notLatestContainer {\r\n    font-style: italic;\r\n    color: gray;\r\n}\r\n.workspaceCommandLink {\r\n    font-weight: bold;\r\n    text-decoration: none;\r\n    color: darkblue;\r\n}\r\n.workspaceCommandLink:hover {\r\n    background-color: lightgray;\r\n}\r\n.workspaceCommandContainer {\r\n\r\n}\r\n.workspaceCommandSetContainer {\r\n    padding: 10px 0px;\r\n    display: inline-block;\r\n\r\n}\r\n.referenceCommandLink {\r\n    text-decoration: none;\r\n    color: darkblue;\r\n}\r\n.referenceCommandLink:hover {\r\n    background-color: lightgray;\r\n}\r\n.referenceCommandContainer {\r\n    \r\n}\r\n.referenceCommandSetContainer {\r\n    padding: 5px 0px;\r\n}\r\n.moreOrLessLink {\r\n    font-size: smaller;\r\n    text-decoration: none;\r\n}\r\n.moreOrLessLink:hover {\r\n    background-color: lightgray;\r\n}\r\n.moreOrLessContainer {\r\n}","uiCode":"return {\n}"},"viewState":{"childDisplayState":{"views":{"Info":{"isViewActive":false},"Display":{"isViewActive":true},"HTML":{"isViewActive":true,"height":7000},"CSS":{"isViewActive":true,"height":7000},"uiGenerator()":{"isViewActive":true,"height":7000},"Formula":{"isViewActive":false},"Private":{"isViewActive":false}}}}}},"viewState":{"childDisplayState":null,"treeState":1,"tabOpened":true}},"viewState":{"treeState":1}}},"viewState":{"treeState":1}}